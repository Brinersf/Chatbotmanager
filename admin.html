<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Clínica Bella Estética</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .admin-card {
            @apply bg-white rounded-xl shadow-lg p-6 border border-gray-200 hover:shadow-xl transition-all duration-300;
        }
        .admin-input {
            @apply w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent;
        }
        .admin-button {
            @apply bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-all duration-300;
        }
        .admin-button-secondary {
            @apply bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-all duration-300;
        }
        .admin-button-danger {
            @apply bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-all duration-300;
        }
        .admin-tab {
            @apply px-4 py-2 rounded-lg cursor-pointer transition-all duration-300;
        }
        .admin-tab.active {
            @apply bg-purple-600 text-white;
        }
        .admin-tab:not(.active) {
            @apply bg-gray-200 text-gray-700 hover:bg-gray-300;
        }
        .stats-card {
            @apply bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl p-6 shadow-lg;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    
    <!-- Proteção de Acesso Admin -->
    <div id="adminProtection" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <div class="text-center mb-6">
                <i class="fas fa-shield-alt text-4xl text-purple-600 mb-4"></i>
                <h2 class="text-2xl font-bold text-gray-800">Acesso Administrativo</h2>
                <p class="text-gray-600 mt-2">Digite a senha de administrador</p>
            </div>
            
            <div class="space-y-4">
                <input type="password" id="adminPassword" placeholder="Senha de administrador" 
                       class="admin-input" onkeypress="if(event.key==='Enter') validateAdminAccess()">
                <button onclick="validateAdminAccess()" class="admin-button w-full">
                    <i class="fas fa-unlock mr-2"></i>Acessar Painel
                </button>
            </div>
            
            <div class="mt-4 text-center">
                <a href="index.html" class="text-purple-600 hover:underline text-sm">
                    <i class="fas fa-arrow-left mr-1"></i>Voltar ao sistema principal
                </a>
            </div>
        </div>
    </div>

    <!-- Painel Principal -->
    <div id="adminPanel" class="hidden">
        
        <!-- Header -->
        <header class="bg-white shadow-lg border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <i class="fas fa-cogs text-2xl text-purple-600 mr-3"></i>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">Painel Administrativo</h1>
                            <p class="text-gray-600 text-sm">Clínica Bella Estética</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600" id="currentDateTime"></span>
                        <button onclick="window.open('index.html', '_blank')" class="admin-button-secondary">
                            <i class="fas fa-external-link-alt mr-2"></i>Ver Sistema
                        </button>
                        <button onclick="logout()" class="admin-button-danger">
                            <i class="fas fa-sign-out-alt mr-2"></i>Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Estatísticas -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="stats-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100">Total Procedimentos</p>
                            <p class="text-2xl font-bold" id="totalProcedures">0</p>
                        </div>
                        <i class="fas fa-spa text-3xl text-purple-200"></i>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100">Agendamentos</p>
                            <p class="text-2xl font-bold" id="totalAppointments">0</p>
                        </div>
                        <i class="fas fa-calendar text-3xl text-purple-200"></i>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100">Preço Médio</p>
                            <p class="text-2xl font-bold" id="averagePrice">R$ 0</p>
                        </div>
                        <i class="fas fa-dollar-sign text-3xl text-purple-200"></i>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100">Hoje</p>
                            <p class="text-2xl font-bold" id="todayAppointments">0</p>
                        </div>
                        <i class="fas fa-clock text-3xl text-purple-200"></i>
                    </div>
                </div>
            </div>

            <!-- Tabs de Navegação -->
            <div class="flex space-x-2 mb-6 bg-white p-2 rounded-xl shadow-lg">
                <button onclick="showTab('clinic')" class="admin-tab active" id="tab-clinic">
                    <i class="fas fa-hospital mr-2"></i>Dados da Clínica
                </button>
                <button onclick="showTab('procedures')" class="admin-tab" id="tab-procedures">
                    <i class="fas fa-spa mr-2"></i>Procedimentos
                </button>
                <button onclick="showTab('schedule')" class="admin-tab" id="tab-schedule">
                    <i class="fas fa-calendar mr-2"></i>Horários
                </button>
                <button onclick="showTab('appointments')" class="admin-tab" id="tab-appointments">
                    <i class="fas fa-list mr-2"></i>Agendamentos
                </button>
                <button onclick="showTab('settings')" class="admin-tab" id="tab-settings">
                    <i class="fas fa-cog mr-2"></i>Configurações
                </button>
            </div>

            <!-- Conteúdo das Abas -->
            
            <!-- Aba: Dados da Clínica -->
            <div id="content-clinic" class="tab-content">
                <div class="admin-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-hospital text-purple-600 mr-2"></i>Informações da Clínica
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Clínica</label>
                            <input type="text" id="clinicName" class="admin-input" placeholder="Nome da clínica">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                            <input type="text" id="clinicPhone" class="admin-input" placeholder="(00) 00000-0000">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" id="clinicEmail" class="admin-input" placeholder="contato@clinica.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Website</label>
                            <input type="text" id="clinicWebsite" class="admin-input" placeholder="www.clinica.com">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Endereço Completo</label>
                            <input type="text" id="clinicAddress" class="admin-input" placeholder="Rua, número - Bairro">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cidade/Estado</label>
                            <input type="text" id="clinicCity" class="admin-input" placeholder="Cidade - UF">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">CEP</label>
                            <input type="text" id="clinicCep" class="admin-input" placeholder="00000-000">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Horários de Funcionamento</label>
                            <input type="text" id="clinicHours" class="admin-input" placeholder="Segunda a Sexta: 8h às 18h">
                        </div>
                    </div>
                    
                    <div class="mt-6 flex space-x-4">
                        <button onclick="saveClinicData()" class="admin-button">
                            <i class="fas fa-save mr-2"></i>Salvar Alterações
                        </button>
                        <button onclick="loadClinicData()" class="admin-button-secondary">
                            <i class="fas fa-refresh mr-2"></i>Recarregar Dados
                        </button>
                    </div>
                </div>
            </div>

            <!-- Aba: Procedimentos -->
            <div id="content-procedures" class="tab-content hidden">
                <div class="admin-card mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-spa text-purple-600 mr-2"></i>Gerenciar Procedimentos
                        </h3>
                        <button onclick="openAddProcedureModal()" class="admin-button">
                            <i class="fas fa-plus mr-2"></i>Novo Procedimento
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Procedimento</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Categoria</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Preço</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Duração</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="proceduresTable">
                                <!-- Preenchido dinamicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Aba: Horários -->
            <div id="content-schedule" class="tab-content hidden">
                <div class="admin-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-calendar text-purple-600 mr-2"></i>Configurar Horários de Atendimento
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Horários Disponíveis</label>
                            <div id="availableHoursList" class="space-y-2 max-h-60 overflow-y-auto">
                                <!-- Preenchido dinamicamente -->
                            </div>
                            <div class="mt-4 flex space-x-2">
                                <input type="time" id="newHour" class="admin-input flex-1">
                                <button onclick="addAvailableHour()" class="admin-button">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Dias de Funcionamento</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" id="workDay1" class="mr-2" checked>
                                    <span>Segunda-feira</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="workDay2" class="mr-2" checked>
                                    <span>Terça-feira</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="workDay3" class="mr-2" checked>
                                    <span>Quarta-feira</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="workDay4" class="mr-2" checked>
                                    <span>Quinta-feira</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="workDay5" class="mr-2" checked>
                                    <span>Sexta-feira</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="workDay6" class="mr-2" checked>
                                    <span>Sábado</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="workDay0" class="mr-2">
                                    <span>Domingo</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button onclick="saveScheduleSettings()" class="admin-button">
                            <i class="fas fa-save mr-2"></i>Salvar Configurações
                        </button>
                    </div>
                </div>
            </div>

            <!-- Aba: Agendamentos -->
            <div id="content-appointments" class="tab-content hidden">
                <div class="admin-card">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-list text-purple-600 mr-2"></i>Lista de Agendamentos
                        </h3>
                        <div class="flex space-x-2">
                            <input type="date" id="filterDate" class="admin-input" onchange="filterAppointments()">
                            <button onclick="exportAppointments()" class="admin-button-secondary">
                                <i class="fas fa-download mr-2"></i>Exportar
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Data/Hora</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Cliente</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Procedimento</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Telefone</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Status</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="appointmentsTable">
                                <!-- Preenchido dinamicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Aba: Configurações -->
            <div id="content-settings" class="tab-content hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="admin-card">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-cog text-purple-600 mr-2"></i>Configurações Gerais
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Máximo de agendamentos por dia</label>
                                <input type="number" id="maxAppointments" class="admin-input" min="1" max="20">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Dias de antecedência para agendamento</label>
                                <input type="number" id="bookingAdvanceDays" class="admin-input" min="1" max="90">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Horas mínimas para cancelamento</label>
                                <input type="number" id="cancellationHours" class="admin-input" min="1" max="72">
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-card">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-database text-purple-600 mr-2"></i>Gerenciar Dados
                        </h3>
                        
                        <div class="space-y-4">
                            <button onclick="backupData()" class="admin-button w-full">
                                <i class="fas fa-download mr-2"></i>Fazer Backup dos Dados
                            </button>
                            <button onclick="document.getElementById('restoreFile').click()" class="admin-button-secondary w-full">
                                <i class="fas fa-upload mr-2"></i>Restaurar Backup
                            </button>
                            <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreData(event)">
                            <button onclick="clearAllData()" class="admin-button-danger w-full">
                                <i class="fas fa-trash mr-2"></i>Limpar Todos os Dados
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="admin-card mt-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-key text-purple-600 mr-2"></i>Alterar Senhas de Acesso
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nova senha do cliente</label>
                            <input type="password" id="newClientPassword" class="admin-input" placeholder="Nova senha para clientes">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nova senha de administrador</label>
                            <input type="password" id="newAdminPassword" class="admin-input" placeholder="Nova senha de admin">
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <button onclick="updatePasswords()" class="admin-button">
                            <i class="fas fa-key mr-2"></i>Atualizar Senhas
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Adicionar/Editar Procedimento -->
    <div id="procedureModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800" id="procedureModalTitle">Novo Procedimento</h3>
                <button onclick="closeProcedureModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Procedimento</label>
                    <input type="text" id="procName" class="admin-input">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                    <select id="procCategory" class="admin-input">
                        <option value="Facial">Facial</option>
                        <option value="Corporal">Corporal</option>
                        <option value="Capilar">Capilar</option>
                        <option value="Outros">Outros</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Preço (R$)</label>
                    <input type="text" id="procPrice" class="admin-input" placeholder="150,00">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Duração</label>
                    <input type="text" id="procDuration" class="admin-input" placeholder="60 min">
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Descrição</label>
                    <textarea id="procDescription" class="admin-input" rows="3"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ícone (Font Awesome)</label>
                    <input type="text" id="procIcon" class="admin-input" placeholder="fas fa-spa">
                </div>
            </div>
            
            <div class="mt-6 flex space-x-4">
                <button onclick="saveProcedure()" class="admin-button">
                    <i class="fas fa-save mr-2"></i>Salvar
                </button>
                <button onclick="closeProcedureModal()" class="admin-button-secondary">
                    <i class="fas fa-times mr-2"></i>Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/shared-data.js"></script>
    <script>
        // ====================================
        // SISTEMA ADMINISTRATIVO
        // ====================================
        
        const AdminSystem = {
            currentEditingProcedure: null,
            
            // Senhas de administrador
            adminPasswords: ['admin2024@bella', 'bella#admin2024', 'estetica@admin', 'dev@admin2024'],
            
            init: function() {
                this.updateDateTime();
                this.loadStats();
                this.loadClinicData();
                this.loadProceduresTable();
                this.loadAvailableHours();
                this.loadAppointmentsTable();
                this.loadSettings();
                
                // Atualizar a cada minuto
                setInterval(() => this.updateDateTime(), 60000);
                setInterval(() => this.loadStats(), 30000);
            },
            
            updateDateTime: function() {
                const now = new Date();
                document.getElementById('currentDateTime').textContent = 
                    now.toLocaleString('pt-BR');
            },
            
            loadStats: function() {
                const stats = DataManager.getStats();
                document.getElementById('totalProcedures').textContent = stats.totalProcedures;
                document.getElementById('totalAppointments').textContent = stats.totalAppointments;
                document.getElementById('todayAppointments').textContent = stats.todayAppointments;
                document.getElementById('averagePrice').textContent = stats.averagePrice;
            },
            
            loadClinicData: function() {
                const clinic = DataManager.clinicData;
                document.getElementById('clinicName').value = clinic.name;
                document.getElementById('clinicPhone').value = clinic.phone;
                document.getElementById('clinicEmail').value = clinic.email;
                document.getElementById('clinicWebsite').value = clinic.website;
                document.getElementById('clinicAddress').value = clinic.address;
                document.getElementById('clinicCity').value = clinic.city;
                document.getElementById('clinicCep').value = clinic.cep;
                document.getElementById('clinicHours').value = clinic.hours;
            },
            
            saveClinicData: function() {
                DataManager.clinicData.name = document.getElementById('clinicName').value;
                DataManager.clinicData.phone = document.getElementById('clinicPhone').value;
                DataManager.clinicData.email = document.getElementById('clinicEmail').value;
                DataManager.clinicData.website = document.getElementById('clinicWebsite').value;
                DataManager.clinicData.address = document.getElementById('clinicAddress').value;
                DataManager.clinicData.city = document.getElementById('clinicCity').value;
                DataManager.clinicData.cep = document.getElementById('clinicCep').value;
                DataManager.clinicData.hours = document.getElementById('clinicHours').value;
                
                DataManager.saveToStorage();
                this.showNotification('Dados da clínica salvos com sucesso!', 'success');
            },
            
            loadProceduresTable: function() {
                const tbody = document.getElementById('proceduresTable');
                let html = '';
                
                DataManager.procedures.forEach(proc => {
                    html += `
                        <tr class="border-b border-gray-200 hover:bg-gray-50">
                            <td class="px-4 py-3">
                                <div class="flex items-center">
                                    <i class="${proc.icon} text-purple-600 mr-2"></i>
                                    <span class="font-medium">${proc.name}</span>
                                </div>
                            </td>
                            <td class="px-4 py-3">${proc.category}</td>
                            <td class="px-4 py-3 font-bold text-purple-600">${proc.price}</td>
                            <td class="px-4 py-3">${proc.duration}</td>
                            <td class="px-4 py-3">
                                <div class="flex space-x-2">
                                    <button onclick="AdminSystem.editProcedure(${proc.id})" class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="AdminSystem.deleteProcedure(${proc.id})" class="text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            },
            
            loadAvailableHours: function() {
                const container = document.getElementById('availableHoursList');
                let html = '';
                
                DataManager.availableHours.forEach((hour, index) => {
                    html += `
                        <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                            <span>${hour}</span>
                            <button onclick="AdminSystem.removeAvailableHour(${index})" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            },
            
            loadAppointmentsTable: function() {
                const tbody = document.getElementById('appointmentsTable');
                let html = '';
                
                DataManager.appointments.forEach(apt => {
                    const date = DataManager.formatDate(apt.date);
                    const time = DataManager.formatTime(apt.time);
                    
                    html += `
                        <tr class="border-b border-gray-200 hover:bg-gray-50">
                            <td class="px-4 py-3">
                                <div class="text-sm">
                                    <div class="font-medium">${date}</div>
                                    <div class="text-gray-600">${time}</div>
                                </div>
                            </td>
                            <td class="px-4 py-3 font-medium">${apt.clientName}</td>
                            <td class="px-4 py-3">${apt.procedure.name}</td>
                            <td class="px-4 py-3">${apt.clientPhone}</td>
                            <td class="px-4 py-3">
                                <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">
                                    ${apt.status || 'Agendado'}
                                </span>
                            </td>
                            <td class="px-4 py-3">
                                <div class="flex space-x-2">
                                    <button onclick="AdminSystem.contactClient('${apt.clientPhone}')" class="text-green-600 hover:text-green-800">
                                        <i class="fab fa-whatsapp"></i>
                                    </button>
                                    <button onclick="AdminSystem.deleteAppointment('${apt.id}')" class="text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html || '<tr><td colspan="6" class="text-center py-4 text-gray-500">Nenhum agendamento encontrado</td></tr>';
            },
            
            loadSettings: function() {
                const config = DataManager.systemConfig;
                document.getElementById('maxAppointments').value = config.maxAppointmentsPerDay;
                document.getElementById('bookingAdvanceDays').value = config.bookingAdvanceDays;
                document.getElementById('cancellationHours').value = config.cancellationHours;
                
                // Carregar dias de trabalho
                config.workingDays.forEach(day => {
                    const checkbox = document.getElementById(`workDay${day}`);
                    if (checkbox) checkbox.checked = true;
                });
            },
            
            editProcedure: function(id) {
                const procedure = DataManager.getProcedureById(id);
                if (!procedure) return;
                
                this.currentEditingProcedure = procedure;
                
                document.getElementById('procedureModalTitle').textContent = 'Editar Procedimento';
                document.getElementById('procName').value = procedure.name;
                document.getElementById('procCategory').value = procedure.category;
                document.getElementById('procPrice').value = procedure.price.replace('R$ ', '');
                document.getElementById('procDuration').value = procedure.duration;
                document.getElementById('procDescription').value = procedure.description;
                document.getElementById('procIcon').value = procedure.icon;
                
                document.getElementById('procedureModal').classList.remove('hidden');
            },
            
            deleteProcedure: function(id) {
                if (confirm('Tem certeza que deseja excluir este procedimento?')) {
                    const index = DataManager.procedures.findIndex(p => p.id === id);
                    if (index > -1) {
                        DataManager.procedures.splice(index, 1);
                        DataManager.saveToStorage();
                        this.loadProceduresTable();
                        this.loadStats();
                        this.showNotification('Procedimento excluído com sucesso!', 'success');
                    }
                }
            },
            
            contactClient: function(phone) {
                const whatsappUrl = `https://wa.me/55${phone.replace(/\D/g, '')}`;
                window.open(whatsappUrl, '_blank');
            },
            
            deleteAppointment: function(id) {
                if (confirm('Tem certeza que deseja excluir este agendamento?')) {
                    const index = DataManager.appointments.findIndex(a => a.id == id);
                    if (index > -1) {
                        DataManager.appointments.splice(index, 1);
                        DataManager.saveToStorage();
                        this.loadAppointmentsTable();
                        this.loadStats();
                        this.showNotification('Agendamento excluído com sucesso!', 'success');
                    }
                }
            },
            
            showNotification: function(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 z-50 p-4 rounded-xl shadow-lg max-w-sm ${
                    type === 'error' ? 'bg-red-600' : 
                    type === 'success' ? 'bg-green-600' : 
                    'bg-blue-600'
                } text-white`;
                
                notification.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas ${type === 'error' ? 'fa-exclamation-triangle' : type === 'success' ? 'fa-check-circle' : 'fa-info-circle'} mr-2"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 5000);
            }
        };
        
        // ====================================
        // FUNÇÕES GLOBAIS
        // ====================================
        
        function validateAdminAccess() {
            const password = document.getElementById('adminPassword').value;
            
            if (AdminSystem.adminPasswords.includes(password)) {
                document.getElementById('adminProtection').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                AdminSystem.init();
            } else {
                AdminSystem.showNotification('Senha incorreta!', 'error');
                document.getElementById('adminPassword').value = '';
            }
        }
        
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                location.reload();
            }
        }
        
        function showTab(tabName) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remover classe active de todas as tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }
        
        function saveClinicData() {
            AdminSystem.saveClinicData();
        }
        
        function loadClinicData() {
            AdminSystem.loadClinicData();
        }
        
        function openAddProcedureModal() {
            AdminSystem.currentEditingProcedure = null;
            document.getElementById('procedureModalTitle').textContent = 'Novo Procedimento';
            
            // Limpar campos
            ['procName', 'procPrice', 'procDuration', 'procDescription', 'procIcon'].forEach(id => {
                document.getElementById(id).value = '';
            });
            document.getElementById('procCategory').value = 'Facial';
            
            document.getElementById('procedureModal').classList.remove('hidden');
        }
        
        function closeProcedureModal() {
            document.getElementById('procedureModal').classList.add('hidden');
        }
        
        function saveProcedure() {
            const data = {
                name: document.getElementById('procName').value,
                category: document.getElementById('procCategory').value,
                price: 'R$ ' + document.getElementById('procPrice').value,
                duration: document.getElementById('procDuration').value,
                description: document.getElementById('procDescription').value,
                icon: document.getElementById('procIcon').value || 'fas fa-spa'
            };
            
            if (!data.name || !data.price || !data.duration) {
                AdminSystem.showNotification('Preencha todos os campos obrigatórios!', 'error');
                return;
            }
            
            if (AdminSystem.currentEditingProcedure) {
                // Editar existente
                const index = DataManager.procedures.findIndex(p => p.id === AdminSystem.currentEditingProcedure.id);
                if (index > -1) {
                    DataManager.procedures[index] = { ...DataManager.procedures[index], ...data };
                }
            } else {
                // Adicionar novo
                const newProcedure = {
                    id: Date.now(),
                    ...data,
                    benefits: ['Benefício 1', 'Benefício 2', 'Benefício 3'],
                    contraindications: ['Consulte um profissional'],
                    aftercare: 'Siga as orientações do profissional'
                };
                DataManager.procedures.push(newProcedure);
            }
            
            DataManager.saveToStorage();
            AdminSystem.loadProceduresTable();
            AdminSystem.loadStats();
            closeProcedureModal();
            AdminSystem.showNotification('Procedimento salvo com sucesso!', 'success');
        }
        
        function addAvailableHour() {
            const newHour = document.getElementById('newHour').value;
            if (newHour && !DataManager.availableHours.includes(newHour)) {
                DataManager.availableHours.push(newHour);
                DataManager.availableHours.sort();
                DataManager.saveToStorage();
                AdminSystem.loadAvailableHours();
                document.getElementById('newHour').value = '';
                AdminSystem.showNotification('Horário adicionado com sucesso!', 'success');
            }
        }
        
        function saveScheduleSettings() {
            const workingDays = [];
            for (let i = 0; i <= 6; i++) {
                const checkbox = document.getElementById(`workDay${i}`);
                if (checkbox && checkbox.checked) {
                    workingDays.push(i);
                }
            }
            
            DataManager.systemConfig.workingDays = workingDays;
            DataManager.saveToStorage();
            AdminSystem.showNotification('Configurações de horário salvos!', 'success');
        }
        
        function filterAppointments() {
            const filterDate = document.getElementById('filterDate').value;
            // Implementar filtro se necessário
            AdminSystem.loadAppointmentsTable();
        }
        
        function exportAppointments() {
            const data = DataManager.appointments.map(apt => ({
                data: apt.date,
                horario: apt.time,
                cliente: apt.clientName,
                telefone: apt.clientPhone,
                procedimento: apt.procedure.name,
                preco: apt.procedure.price
            }));
            
            const csv = [
                ['Data', 'Horário', 'Cliente', 'Telefone', 'Procedimento', 'Preço'],
                ...data.map(row => Object.values(row))
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `agendamentos-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function backupData() {
            const backup = {
                clinicData: DataManager.clinicData,
                procedures: DataManager.procedures,
                appointments: DataManager.appointments,
                availableHours: DataManager.availableHours,
                systemConfig: DataManager.systemConfig,
                backupDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-bella-clinica-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            AdminSystem.showNotification('Backup criado com sucesso!', 'success');
        }
        
        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    if (confirm('Tem certeza que deseja restaurar o backup? Todos os dados atuais serão substituídos!')) {
                        DataManager.clinicData = backup.clinicData || DataManager.clinicData;
                        DataManager.procedures = backup.procedures || DataManager.procedures;
                        DataManager.appointments = backup.appointments || [];
                        DataManager.availableHours = backup.availableHours || DataManager.availableHours;
                        DataManager.systemConfig = { ...DataManager.systemConfig, ...backup.systemConfig };
                        
                        DataManager.saveToStorage();
                        AdminSystem.init();
                        AdminSystem.showNotification('Backup restaurado com sucesso!', 'success');
                    }
                } catch (error) {
                    AdminSystem.showNotification('Erro ao restaurar backup!', 'error');
                }
            };
            reader.readAsText(file);
        }
        
        function clearAllData() {
            if (confirm('ATENÇÃO: Isso irá apagar TODOS os dados do sistema! Tem certeza?')) {
                if (confirm('Esta ação não pode ser desfeita. Confirma a exclusão de todos os dados?')) {
                    DataManager.clearStorage();
                    location.reload();
                }
            }
        }
        
        function updatePasswords() {
            const clientPass = document.getElementById('newClientPassword').value;
            const adminPass = document.getElementById('newAdminPassword').value;
            
            if (clientPass || adminPass) {
                AdminSystem.showNotification('Senhas atualizadas! (Funcionalidade simulada)', 'success');
                document.getElementById('newClientPassword').value = '';
                document.getElementById('newAdminPassword').value = '';
            }
        }
        
        // Remover horário disponível
        AdminSystem.removeAvailableHour = function(index) {
            DataManager.availableHours.splice(index, 1);
            DataManager.saveToStorage();
            this.loadAvailableHours();
            this.showNotification('Horário removido!', 'success');
        };
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Aguardar DataManager
            setTimeout(() => {
                console.log('🛠️ Painel Administrativo carregado!');
            }, 100);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97951703e1f56485',t:'MTc1NjkwMDg1OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

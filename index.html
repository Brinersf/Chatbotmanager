<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatBot Manager - Clínicas de Estética</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .chat-bubble-user {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .chat-bubble-bot {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-robot text-2xl"></i>
                    <h1 class="text-2xl font-bold">ChatBot Manager</h1>
                </div>
                <nav class="hidden md:flex space-x-6">
                    <button onclick="showSection('dashboard')" class="nav-btn hover:text-pink-200 transition-colors">Dashboard</button>
                    <button onclick="showSection('procedures')" class="nav-btn hover:text-pink-200 transition-colors">Procedimentos</button>
                    <button onclick="showSection('schedule')" class="nav-btn hover:text-pink-200 transition-colors">Agenda</button>
                    <button onclick="showSection('chatbot')" class="nav-btn hover:text-pink-200 transition-colors">ChatBot</button>
                    <button onclick="showSection('settings')" class="nav-btn hover:text-pink-200 transition-colors">Configurações</button>
                </nav>
                <button class="md:hidden" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="hidden bg-white shadow-lg md:hidden">
        <div class="px-6 py-4 space-y-2">
            <button onclick="showSection('dashboard')" class="block w-full text-left py-2 text-gray-700 hover:text-purple-600">Dashboard</button>
            <button onclick="showSection('procedures')" class="block w-full text-left py-2 text-gray-700 hover:text-purple-600">Procedimentos</button>
            <button onclick="showSection('schedule')" class="block w-full text-left py-2 text-gray-700 hover:text-purple-600">Agenda</button>
            <button onclick="showSection('chatbot')" class="block w-full text-left py-2 text-gray-700 hover:text-purple-600">ChatBot</button>
            <button onclick="showSection('settings')" class="block w-full text-left py-2 text-gray-700 hover:text-purple-600">Configurações</button>
        </div>
    </div>

    <div class="container mx-auto px-6 py-8">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Dashboard</h2>
                <p class="text-gray-600">Visão geral do seu chatbot e estatísticas</p>
            </div>

            <!-- Main Management Card -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <div class="text-center mb-6">
                    <div class="w-20 h-20 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-robot text-white text-3xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Gerenciar Secretária Virtual</h3>
                    <p class="text-gray-600">Configure as perguntas e respostas que sua secretária virtual irá usar para cada procedimento</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- FAQ Management -->
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-xl border border-blue-200">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mr-4">
                                <i class="fas fa-question-circle text-white text-xl"></i>
                            </div>
                            <div>
                                <h4 class="text-lg font-bold text-blue-800">Perguntas & Respostas</h4>
                                <p class="text-sm text-blue-600">Configure o conhecimento da IA</p>
                            </div>
                        </div>
                        <p class="text-blue-700 text-sm mb-4">Gerencie todas as perguntas frequentes que os clientes fazem sobre cada procedimento. Sua secretária virtual usará essas informações para responder automaticamente.</p>
                        <button onclick="showSection('faq-management')" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all font-medium">
                            <i class="fas fa-cog mr-2"></i>Gerenciar FAQ dos Procedimentos
                        </button>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="bg-gradient-to-r from-green-50 to-teal-50 p-6 rounded-xl border border-green-200">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mr-4">
                                <i class="fas fa-chart-bar text-white text-xl"></i>
                            </div>
                            <div>
                                <h4 class="text-lg font-bold text-green-800">Estatísticas Rápidas</h4>
                                <p class="text-sm text-green-600">Visão geral do sistema</p>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-green-700 text-sm">Procedimentos cadastrados:</span>
                                <span class="font-bold text-green-800" id="totalProcedures">15</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-green-700 text-sm">Total de FAQs:</span>
                                <span class="font-bold text-green-800" id="totalFAQs">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-green-700 text-sm">Agendamentos hoje:</span>
                                <span class="font-bold text-green-800" id="todayAppointments">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Ações Rápidas</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="showSection('procedures')" class="flex items-center p-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all">
                        <i class="fas fa-plus-circle mr-3"></i>
                        Adicionar Procedimento
                    </button>
                    <button onclick="generateChatLink()" class="flex items-center p-4 bg-gradient-to-r from-green-500 to-teal-600 text-white rounded-lg hover:from-green-600 hover:to-teal-700 transition-all">
                        <i class="fas fa-link mr-3"></i>
                        Gerar Link do Chat
                    </button>
                    <button onclick="showSection('chatbot')" class="flex items-center p-4 bg-gradient-to-r from-pink-500 to-red-600 text-white rounded-lg hover:from-pink-600 hover:to-red-700 transition-all">
                        <i class="fas fa-robot mr-3"></i>
                        Testar ChatBot
                    </button>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Atividade Recente</h3>
                <div class="space-y-4">
                    <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                        <div class="w-2 h-2 bg-green-500 rounded-full mr-3"></div>
                        <div class="flex-1">
                            <p class="text-sm text-gray-800">Nova consulta agendada - Botox</p>
                            <p class="text-xs text-gray-500">há 5 minutos</p>
                        </div>
                    </div>
                    <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                        <div class="w-2 h-2 bg-blue-500 rounded-full mr-3"></div>
                        <div class="flex-1">
                            <p class="text-sm text-gray-800">Cliente solicitou informações sobre Preenchimento</p>
                            <p class="text-xs text-gray-500">há 12 minutos</p>
                        </div>
                    </div>
                    <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                        <div class="w-2 h-2 bg-purple-500 rounded-full mr-3"></div>
                        <div class="flex-1">
                            <p class="text-sm text-gray-800">Lembrete enviado para consulta de amanhã</p>
                            <p class="text-xs text-gray-500">há 1 hora</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Procedures Section -->
        <div id="procedures" class="section hidden">
            <div class="mb-8">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Gerenciar Procedimentos</h2>
                        <p class="text-gray-600">Adicione, edite e configure seus tratamentos</p>
                    </div>
                    <button onclick="openProcedureModal()" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all">
                        <i class="fas fa-plus mr-2"></i>Novo Procedimento
                    </button>
                </div>
            </div>

            <!-- Procedures Grid -->
            <div id="proceduresGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Procedures will be loaded here -->
            </div>
        </div>

        <!-- Schedule Section -->
        <div id="schedule" class="section hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Gerenciar Agenda</h2>
                <p class="text-gray-600">Configure horários de atendimento e disponibilidade</p>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                <!-- Schedule Configuration -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Horários de Funcionamento</h3>
                    <div class="space-y-4" id="scheduleConfig">
                        <!-- Schedule items will be loaded here -->
                    </div>
                    <button onclick="saveSchedule()" class="mt-4 w-full bg-gradient-to-r from-green-500 to-teal-600 text-white py-2 rounded-lg hover:from-green-600 hover:to-teal-700 transition-all">
                        Salvar Horários
                    </button>
                </div>

                <!-- Calendar -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">Calendário de Disponibilidade</h3>
                        <div class="flex space-x-2">
                            <button onclick="previousMonth()" class="p-2 text-gray-600 hover:text-purple-600 transition-colors">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button onclick="nextMonth()" class="p-2 text-gray-600 hover:text-purple-600 transition-colors">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="text-center mb-4">
                        <h4 id="currentMonth" class="text-lg font-semibold text-gray-800"></h4>
                    </div>
                    
                    <div class="grid grid-cols-7 gap-1 mb-2">
                        <div class="text-center text-xs font-medium text-gray-500 p-2">Dom</div>
                        <div class="text-center text-xs font-medium text-gray-500 p-2">Seg</div>
                        <div class="text-center text-xs font-medium text-gray-500 p-2">Ter</div>
                        <div class="text-center text-xs font-medium text-gray-500 p-2">Qua</div>
                        <div class="text-center text-xs font-medium text-gray-500 p-2">Qui</div>
                        <div class="text-center text-xs font-medium text-gray-500 p-2">Sex</div>
                        <div class="text-center text-xs font-medium text-gray-500 p-2">Sáb</div>
                    </div>
                    
                    <div id="calendarGrid" class="grid grid-cols-7 gap-1">
                        <!-- Calendar days will be generated here -->
                    </div>
                    
                    <div class="mt-4 text-xs space-y-1">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-green-200 rounded mr-2"></div>
                            <span class="text-gray-600">Disponível</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-red-200 rounded mr-2"></div>
                            <span class="text-gray-600">Bloqueado</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-yellow-200 rounded mr-2"></div>
                            <span class="text-gray-600">Horário Limitado</span>
                        </div>
                    </div>
                </div>

                <!-- Day Details -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Detalhes do Dia</h3>
                    <div id="dayDetails">
                        <p class="text-gray-500 text-center py-8">Clique em um dia no calendário para ver os detalhes</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ChatBot Section -->
        <div id="chatbot" class="section hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Testar ChatBot</h2>
                <p class="text-gray-600">Visualize como seus clientes interagem com o bot</p>
            </div>

            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <!-- Chat Header -->
                <div class="gradient-bg text-white p-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-spa text-lg"></i>
                        </div>
                        <div>
                            <h3 class="font-bold" id="clinicName">Clínica Bella Estética</h3>
                            <p class="text-sm opacity-90">Online agora</p>
                        </div>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div id="chatMessages" class="h-96 overflow-y-auto p-4 bg-gray-50">
                    <div class="flex mb-4">
                        <div class="chat-bubble-bot text-white p-3 rounded-lg max-w-xs">
                            <p>Olá! 👋 Bem-vindo à nossa clínica! Como posso ajudá-lo hoje?</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="p-4 bg-white border-t">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
                        <button onclick="sendQuickMessage('Quero agendar')" class="bg-purple-100 text-purple-700 px-3 py-2 rounded-lg text-sm hover:bg-purple-200 transition-colors">
                            📅 Agendar
                        </button>
                        <div class="relative">
                            <button onclick="toggleProceduresDropdown()" class="w-full bg-pink-100 text-pink-700 px-3 py-2 rounded-lg text-sm hover:bg-pink-200 transition-colors flex items-center justify-between">
                                💆‍♀️ Procedimentos
                                <i class="fas fa-chevron-down text-xs"></i>
                            </button>
                            <div id="proceduresDropdown" class="hidden absolute bottom-full left-0 w-72 bg-white border border-gray-200 rounded-xl shadow-2xl z-10 mb-2 max-h-80 overflow-y-auto">
                                <div id="proceduresList">
                                    <!-- Procedures will be loaded here -->
                                </div>
                            </div>
                        </div>
                        <div class="relative">
                            <button onclick="toggleFAQDropdown()" class="w-full bg-green-100 text-green-700 px-3 py-2 rounded-lg text-sm hover:bg-green-200 transition-colors flex items-center justify-between">
                                ❓ Perguntas Frequentes
                                <i class="fas fa-chevron-down text-xs"></i>
                            </button>
                            <div id="faqDropdown" class="hidden absolute bottom-full left-0 w-72 bg-white border border-gray-200 rounded-xl shadow-2xl z-10 mb-2 max-h-80 overflow-y-auto">
                                <div id="faqProceduresList">
                                    <!-- FAQ Procedures will be loaded here -->
                                </div>
                            </div>
                        </div>
                        <button onclick="sendQuickMessage('Localização')" class="bg-blue-100 text-blue-700 px-3 py-2 rounded-lg text-sm hover:bg-blue-200 transition-colors">
                            📍 Localização
                        </button>
                    </div>

                    <!-- Chat Input -->
                    <div class="flex">
                        <input type="text" id="chatInput" placeholder="Digite sua mensagem..." class="flex-1 p-3 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <button onclick="sendMessage()" class="gradient-bg text-white px-6 py-3 rounded-r-lg hover:opacity-90 transition-opacity">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- FAQ Management Section -->
        <div id="faq-management" class="section hidden">
            <div class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Gerenciar FAQ dos Procedimentos</h2>
                        <p class="text-gray-600">Configure as perguntas e respostas que sua secretária virtual usará</p>
                    </div>
                    <button onclick="showSection('dashboard')" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>Voltar ao Dashboard
                    </button>
                </div>
            </div>

            <!-- Procedures List for FAQ Management -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Procedures List -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-xl shadow-lg p-6 sticky top-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-list mr-2 text-purple-600"></i>Procedimentos
                        </h3>
                        <div id="faqProceduresList" class="space-y-2 max-h-96 overflow-y-auto">
                            <!-- Procedures will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- FAQ Editor -->
                <div class="lg:col-span-2">
                    <div id="faqEditor" class="bg-white rounded-xl shadow-lg p-6">
                        <div class="text-center py-12">
                            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-arrow-left text-gray-400 text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-600 mb-2">Selecione um Procedimento</h3>
                            <p class="text-gray-500">Escolha um procedimento na lista ao lado para gerenciar suas perguntas e respostas</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings" class="section hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Configurações</h2>
                <p class="text-gray-600">Personalize seu chatbot e configurações da clínica</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Clinic Info -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Informações da Clínica</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Clínica</label>
                            <input type="text" id="clinicNameInput" value="Clínica Bella Estética" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                            <input type="text" id="clinicPhone" value="(11) 99999-9999" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Endereço</label>
                            <textarea id="clinicAddress" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">Rua das Flores, 123 - Centro, São Paulo - SP</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Logo da Clínica (URL)</label>
                            <input type="url" id="clinicLogo" placeholder="https://exemplo.com/logo.png" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- Payment Methods -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Formas de Pagamento</h3>
                    <div class="space-y-3" id="paymentMethods">
                        <!-- Payment methods will be loaded here -->
                    </div>
                    <button onclick="addPaymentMethod()" class="mt-4 w-full bg-gradient-to-r from-green-500 to-teal-600 text-white py-2 rounded-lg hover:from-green-600 hover:to-teal-700 transition-all">
                        <i class="fas fa-plus mr-2"></i>Adicionar Forma de Pagamento
                    </button>
                </div>

                <!-- Chat Link Generator -->
                <div class="bg-white rounded-xl shadow-lg p-6 lg:col-span-2">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Gerar Link do ChatBot</h3>
                    <p class="text-gray-600 mb-4">Use este link em seu WhatsApp, Instagram, site ou qualquer lugar!</p>
                    <div class="flex">
                        <input type="text" id="chatLinkInput" readonly class="flex-1 p-3 border border-gray-300 rounded-l-lg bg-gray-50" value="https://chatbot.clinica.com/bella-estetica">
                        <button onclick="copyChatLink()" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-r-lg hover:from-purple-700 hover:to-pink-700 transition-all">
                            <i class="fas fa-copy mr-2"></i>Copiar
                        </button>
                    </div>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="shareToWhatsApp()" class="flex items-center justify-center p-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                            <i class="fab fa-whatsapp mr-2"></i>WhatsApp
                        </button>
                        <button onclick="shareToInstagram()" class="flex items-center justify-center p-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all">
                            <i class="fab fa-instagram mr-2"></i>Instagram
                        </button>
                        <button onclick="downloadQRCode()" class="flex items-center justify-center p-3 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition-colors">
                            <i class="fas fa-qrcode mr-2"></i>QR Code
                        </button>
                    </div>
                </div>
            </div>

            <div class="mt-8 text-center">
                <button onclick="saveSettings()" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-3 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all text-lg font-semibold">
                    <i class="fas fa-save mr-2"></i>Salvar Todas as Configurações
                </button>
            </div>
        </div>
    </div>

    <!-- Procedure Modal -->
    <div id="procedureModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Adicionar Procedimento</h3>
                <button onclick="closeProcedureModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="space-y-4 max-h-96 overflow-y-auto">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Procedimento</label>
                        <input type="text" id="procedureName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                        <select id="procedureCategory" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="Harmonização Facial">Harmonização Facial</option>
                            <option value="Tratamentos Faciais">Tratamentos Faciais</option>
                            <option value="Tratamentos Corporais">Tratamentos Corporais</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Preço (R$)</label>
                        <input type="number" id="procedurePrice" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Duração (min)</label>
                        <input type="number" id="procedureDuration" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ícone</label>
                        <input type="text" id="procedureIcon" placeholder="💉" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Descrição</label>
                    <textarea id="procedureDescription" rows="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Benefícios (separados por vírgula)</label>
                    <textarea id="procedureBenefits" rows="2" placeholder="Benefício 1, Benefício 2, Benefício 3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Formas de Pagamento (separadas por vírgula)</label>
                    <textarea id="procedurePayments" rows="2" placeholder="À vista com desconto, Cartão em até 6x, PIX" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Contraindicações</label>
                    <textarea id="procedureContraindications" rows="2" placeholder="Gravidez, amamentação, etc." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Perguntas Frequentes (uma por linha no formato: Pergunta?|Resposta)</label>
                    <textarea id="procedureFAQ" rows="4" placeholder="Dói durante o procedimento?|Não, é bem tranquilo e usamos anestésico se necessário! 😊" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                </div>
                <div class="flex space-x-3">
                    <button onclick="saveProcedure()" class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white py-2 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all">
                        Salvar
                    </button>
                    <button onclick="closeProcedureModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Day Schedule Modal -->
    <div id="dayScheduleModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800" id="modalDayTitle">Configurar Dia</h3>
                <button onclick="closeDayScheduleModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div class="flex items-center space-x-4">
                    <label class="flex items-center">
                        <input type="radio" name="dayStatus" value="available" class="mr-2" checked>
                        <span class="text-green-600">Disponível</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="dayStatus" value="blocked" class="mr-2">
                        <span class="text-red-600">Bloqueado</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="dayStatus" value="limited" class="mr-2">
                        <span class="text-yellow-600">Horário Limitado</span>
                    </label>
                </div>
                
                <div id="customScheduleSection" class="space-y-3">
                    <h4 class="font-semibold text-gray-700">Horários Personalizados</h4>
                    <div id="customTimeSlots">
                        <!-- Custom time slots will be added here -->
                    </div>
                    <button onclick="addTimeSlot()" class="text-purple-600 hover:text-purple-800 text-sm">
                        <i class="fas fa-plus mr-1"></i>Adicionar Horário
                    </button>
                </div>
                
                <div class="space-y-3">
                    <label class="block text-sm font-medium text-gray-700">Observações</label>
                    <textarea id="dayNotes" rows="3" placeholder="Ex: Apenas procedimentos rápidos, feriado, etc." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="saveDaySchedule()" class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white py-2 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all">
                        Salvar
                    </button>
                    <button onclick="closeDayScheduleModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scheduling Modal -->
    <div id="schedulingModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-800">Agendar Procedimento</h3>
                <button onclick="closeSchedulingModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- Selected Procedure Info -->
            <div id="selectedProcedureInfo" class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-lg mb-6">
                <!-- Procedure info will be loaded here -->
            </div>
            
            <!-- Scheduling Form -->
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                        <input type="text" id="clientName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Digite seu nome">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                        <input type="tel" id="clientPhone" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="(11) 99999-9999">
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data Preferida</label>
                        <input type="date" id="appointmentDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Horário Preferido</label>
                        <select id="appointmentTime" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">Selecione um horário</option>
                            <option value="08:00">08:00</option>
                            <option value="09:00">09:00</option>
                            <option value="10:00">10:00</option>
                            <option value="11:00">11:00</option>
                            <option value="14:00">14:00</option>
                            <option value="15:00">15:00</option>
                            <option value="16:00">16:00</option>
                            <option value="17:00">17:00</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Observações (opcional)</label>
                    <textarea id="appointmentNotes" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Alguma observação especial?"></textarea>
                </div>
                
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-blue-800 mb-2">📋 Informações Importantes:</h4>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>• Chegue 15 minutos antes do horário agendado</li>
                        <li>• Traga um documento com foto</li>
                        <li>• Em caso de cancelamento, avise com 24h de antecedência</li>
                    </ul>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button onclick="confirmScheduling()" class="flex-1 bg-gradient-to-r from-green-500 to-teal-600 text-white py-3 rounded-lg hover:from-green-600 hover:to-teal-700 transition-all font-semibold">
                        <i class="fas fa-calendar-check mr-2"></i>Confirmar Agendamento
                    </button>
                    <button onclick="closeSchedulingModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition-colors">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-sm mx-4 text-center">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check text-green-600 text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Sucesso!</h3>
            <p id="successMessage" class="text-gray-600 mb-4">Operação realizada com sucesso!</p>
            <button onclick="closeSuccessModal()" class="bg-gradient-to-r from-green-500 to-teal-600 text-white px-6 py-2 rounded-lg hover:from-green-600 hover:to-teal-700 transition-all">
                OK
            </button>
        </div>
    </div>

    <script>
        // Global data storage
        let clinicData = {
            name: "Clínica Bella Estética",
            phone: "(11) 99999-9999",
            address: "Rua das Flores, 123 - Centro, São Paulo - SP",
            logo: "",
            procedures: [
                {
                    id: 1,
                    name: "Botox",
                    price: 800,
                    duration: 60,
                    description: "Aplicação de toxina botulínica para redução de rugas e linhas de expressão.",
                    benefits: ["Reduz rugas dinâmicas", "Previne novas linhas", "Resultado natural", "Sem tempo de recuperação"],
                    category: "Harmonização Facial",
                    icon: "💉",
                    paymentOptions: ["À vista com 10% desconto", "Cartão em até 6x", "PIX"],
                    contraindications: "Gravidez, amamentação, doenças neuromusculares",
                    faq: [
                        { question: "Dói para aplicar botox?", answer: "O desconforto é mínimo! Usamos agulhas muito finas e, se necessário, aplicamos anestésico tópico. A maioria dos pacientes relata apenas uma leve sensação de picada. 😊" },
                        { question: "Quanto tempo dura o efeito?", answer: "O efeito do botox dura em média de 4 a 6 meses. Com aplicações regulares, o músculo vai 'aprendendo' a relaxar e o intervalo entre as sessões pode aumentar! ✨" },
                        { question: "Quando vejo o resultado?", answer: "Os primeiros resultados aparecem entre 3 a 5 dias, mas o efeito completo é visto em até 15 dias após a aplicação. Vale a pena aguardar! 📅" },
                        { question: "Posso fazer exercícios depois?", answer: "Recomendamos evitar exercícios intensos nas primeiras 24h. Depois disso, pode voltar à rotina normal sem problemas! 💪" }
                    ]
                },
                {
                    id: 2,
                    name: "Preenchimento Labial",
                    price: 1200,
                    duration: 90,
                    description: "Preenchimento com ácido hialurônico para aumento e definição dos lábios.",
                    benefits: ["Lábios mais volumosos", "Contorno definido", "Hidratação profunda", "Resultado imediato"],
                    category: "Harmonização Facial",
                    icon: "💋",
                    paymentOptions: ["À vista com 15% desconto", "Cartão em até 8x", "PIX"],
                    contraindications: "Herpes ativo, alergia ao ácido hialurônico",
                    faq: [
                        { question: "Fica natural ou artificial?", answer: "Nosso foco é sempre o resultado natural! Respeitamos a anatomia de cada pessoa e aplicamos a quantidade ideal para realçar sua beleza sem exageros. 💋" },
                        { question: "Quanto tempo para desinchar?", answer: "O inchaço é normal nas primeiras 48-72h. Aplicamos gelo e orientamos cuidados para acelerar a recuperação. Em uma semana você já vê o resultado final! ❄️" },
                        { question: "Posso beijar depois do procedimento?", answer: "Recomendamos evitar beijos e pressão nos lábios nas primeiras 24-48h para não comprometer o resultado. Depois disso, beije à vontade! 😘" },
                        { question: "Preciso retocar sempre?", answer: "O ácido hialurônico dura de 8 a 12 meses. Muitas pacientes fazem retoques a cada 6-8 meses para manter o resultado sempre perfeito! ⏰" }
                    ]
                },
                {
                    id: 3,
                    name: "Limpeza de Pele Profunda",
                    price: 150,
                    duration: 120,
                    description: "Limpeza profunda da pele com extração de cravos e hidratação intensiva.",
                    benefits: ["Remove impurezas", "Desobstrui poros", "Pele mais lisa", "Renovação celular"],
                    category: "Tratamentos Faciais",
                    icon: "✨",
                    paymentOptions: ["À vista", "Cartão em até 3x", "PIX"],
                    contraindications: "Pele muito sensível, lesões ativas",
                    faq: [
                        { question: "Dói na hora da extração?", answer: "Pode haver um leve desconforto durante a extração, mas usamos técnicas suaves e produtos calmantes. O resultado vale muito a pena! 😌" },
                        { question: "Com que frequência devo fazer?", answer: "Para peles oleosas, recomendamos mensalmente. Para peles normais/secas, a cada 2-3 meses é suficiente. Vamos personalizar para você! 📅" },
                        { question: "Posso usar maquiagem depois?", answer: "Recomendamos aguardar 24h antes de aplicar maquiagem para deixar a pele respirar e se recuperar completamente. 💄" },
                        { question: "Minha pele vai ficar vermelha?", answer: "É normal ficar levemente avermelhada por algumas horas. Aplicamos produtos calmantes e em 24h sua pele estará radiante! ✨" }
                    ]
                },
                {
                    id: 4,
                    name: "Peeling Químico",
                    price: 300,
                    duration: 90,
                    description: "Renovação celular através de ácidos para melhorar textura e uniformidade da pele.",
                    benefits: ["Reduz manchas", "Melhora textura", "Estimula colágeno", "Pele mais jovem"],
                    category: "Tratamentos Faciais",
                    icon: "🧴",
                    paymentOptions: ["À vista com 10% desconto", "Cartão em até 4x", "PIX"],
                    contraindications: "Gravidez, pele bronzeada recentemente",
                    faq: [
                        { question: "A pele vai descascar muito?", answer: "Depende do tipo de peeling! Nos superficiais, a descamação é mínima. Nos médios, pode descamar por 3-7 dias. Orientamos todos os cuidados! 🧴" },
                        { question: "Posso tomar sol depois?", answer: "Deve evitar sol direto por pelo menos 15 dias e usar protetor solar religiosamente. A pele fica mais sensível temporariamente. ☀️" },
                        { question: "Quantas sessões preciso?", answer: "Geralmente 3-6 sessões com intervalos de 15-30 dias, dependendo do objetivo. Avaliamos sua pele e criamos um protocolo personalizado! 📋" },
                        { question: "Posso fazer no verão?", answer: "Preferimos outono/inverno pela menor exposição solar. Mas com cuidados rigorosos, é possível fazer em qualquer época do ano! 🌤️" }
                    ]
                },
                {
                    id: 5,
                    name: "Microagulhamento",
                    price: 250,
                    duration: 75,
                    description: "Estímulo da produção de colágeno através de microlesões controladas.",
                    benefits: ["Reduz cicatrizes", "Melhora firmeza", "Uniformiza tom", "Rejuvenesce"],
                    category: "Tratamentos Faciais",
                    icon: "🔬",
                    paymentOptions: ["À vista", "Cartão em até 5x", "PIX"],
                    contraindications: "Infecções ativas, queloides",
                    faq: [
                        { question: "Dói durante o procedimento?", answer: "Sentimos apenas um leve formigamento! Aplicamos anestésico tópico antes para maior conforto. É bem tolerável! 😊" },
                        { question: "Quantas sessões são necessárias?", answer: "Para cicatrizes de acne: 4-6 sessões. Para rejuvenescimento: 3-4 sessões. Intervalos de 30 dias entre cada uma! 📅" },
                        { question: "A pele fica vermelha depois?", answer: "Sim, fica avermelhada por 24-48h, como uma queimadura solar leve. Orientamos cuidados para acelerar a recuperação! 🌹" },
                        { question: "Posso usar maquiagem no dia seguinte?", answer: "Recomendamos aguardar 24h. Use apenas produtos hipoalergênicos e protetor solar sempre! 💄" }
                    ]
                },
                {
                    id: 6,
                    name: "Harmonização Facial Completa",
                    price: 2500,
                    duration: 180,
                    description: "Protocolo completo de harmonização facial com botox e preenchimentos estratégicos.",
                    benefits: ["Rosto harmonioso", "Rejuvenescimento", "Autoestima elevada", "Resultado duradouro"],
                    category: "Harmonização Facial",
                    icon: "👑",
                    paymentOptions: ["À vista com 20% desconto", "Cartão em até 12x", "PIX"],
                    contraindications: "Gravidez, amamentação, expectativas irreais",
                    faq: [
                        { question: "Quanto tempo dura todo o procedimento?", answer: "A sessão completa leva cerca de 3 horas. Fazemos com calma, respeitando cada etapa para um resultado perfeito! ⏰" },
                        { question: "Preciso de várias sessões?", answer: "Geralmente conseguimos o resultado desejado em uma única sessão! Retornos são apenas para ajustes finos se necessário. ✨" },
                        { question: "Fico com cara de 'operado'?", answer: "Jamais! Nosso foco é realçar sua beleza natural. Você fica com uma versão melhorada de si mesma! 💫" },
                        { question: "Quando posso voltar ao trabalho?", answer: "Pode voltar no dia seguinte! Pode haver leve inchaço por 2-3 dias, mas nada que impeça suas atividades normais. 💼" }
                    ]
                },
                {
                    id: 7,
                    name: "Radiofrequência Facial",
                    price: 200,
                    duration: 60,
                    description: "Tratamento não invasivo que estimula colágeno através do calor controlado.",
                    benefits: ["Firmeza da pele", "Reduz flacidez", "Melhora contorno", "Sem dor"],
                    category: "Tratamentos Corporais",
                    icon: "⚡",
                    paymentOptions: ["À vista", "Cartão em até 4x", "PIX"],
                    contraindications: "Marca-passo, próteses metálicas",
                    faq: [
                        { question: "Sinto dor durante o tratamento?", answer: "Não! Você sente apenas um calor gostoso e relaxante. Muitas pacientes até adormecem durante a sessão! 😴" },
                        { question: "Quantas sessões preciso fazer?", answer: "Recomendamos 6-8 sessões semanais para resultados ótimos. Depois, manutenção mensal para manter os benefícios! 📊" },
                        { question: "Vejo resultado desde a primeira sessão?", answer: "Sim! A pele fica mais firme imediatamente. Os resultados vão melhorando progressivamente a cada sessão! 🌟" },
                        { question: "Posso fazer no corpo também?", answer: "Claro! Fazemos radiofrequência corporal para flacidez, celulite e gordura localizada. Muito eficaz! 💪" }
                    ]
                },
                {
                    id: 8,
                    name: "Drenagem Linfática",
                    price: 120,
                    duration: 90,
                    description: "Massagem terapêutica para redução de inchaço e melhora da circulação.",
                    benefits: ["Reduz inchaço", "Melhora circulação", "Relaxamento", "Desintoxica"],
                    category: "Tratamentos Corporais",
                    icon: "🤲",
                    paymentOptions: ["À vista", "Cartão em até 2x", "PIX"],
                    contraindications: "Trombose, infecções agudas",
                    faq: [
                        { question: "Dói ou é relaxante?", answer: "É super relaxante! A pressão é suave e rítmica. Muitas clientes adormecem durante a sessão. Puro relaxamento! 😌" },
                        { question: "Com que frequência devo fazer?", answer: "Para manutenção: quinzenal. Para tratamento intensivo: 2-3x por semana. Vamos adequar às suas necessidades! 📅" },
                        { question: "Ajuda mesmo a desinchar?", answer: "Sim! Você sai visivelmente menos inchada. Ótima para pós-operatório, retenção de líquido e bem-estar geral! 💧" },
                        { question: "Posso fazer grávida?", answer: "Sim, mas com técnicas específicas para gestantes! É ótima para reduzir o inchaço das pernas e pés. 🤰" }
                    ]
                },
                {
                    id: 9,
                    name: "Criolipólise",
                    price: 800,
                    duration: 120,
                    description: "Redução de gordura localizada através do congelamento controlado das células.",
                    benefits: ["Reduz gordura", "Não invasivo", "Sem cirurgia", "Resultados duradouros"],
                    category: "Tratamentos Corporais",
                    icon: "❄️",
                    paymentOptions: ["À vista com 15% desconto", "Cartão em até 10x", "PIX"],
                    contraindications: "Gravidez, crioglobulinemia",
                    faq: [
                        { question: "Dói muito o frio?", answer: "Os primeiros 10 minutos são desconfortáveis, depois a área fica anestesiada pelo frio. Você pode até relaxar! ❄️" },
                        { question: "Quantos cm posso perder?", answer: "Em média 20-25% da gordura local é eliminada. Isso representa 2-4cm de redução na área tratada! 📏" },
                        { question: "Quando vejo o resultado final?", answer: "O resultado aparece gradualmente. Em 30 dias já nota diferença, resultado final em 60-90 dias! ⏰" },
                        { question: "Posso fazer em várias áreas?", answer: "Sim! Tratamos abdômen, flancos, culote, papada, braços. Podemos fazer até 2 áreas por sessão! 🎯" }
                    ]
                }
            ],
            schedule: {
                monday: { active: true, start: "08:00", end: "18:00" },
                tuesday: { active: true, start: "08:00", end: "18:00" },
                wednesday: { active: true, start: "08:00", end: "18:00" },
                thursday: { active: true, start: "08:00", end: "18:00" },
                friday: { active: true, start: "08:00", end: "18:00" },
                saturday: { active: true, start: "08:00", end: "14:00" },
                sunday: { active: false, start: "08:00", end: "18:00" }
            },
            paymentMethods: ["Dinheiro", "Cartão de Crédito", "Cartão de Débito", "PIX"],
            blockedDates: [],
            customSchedules: {} // Format: { "2024-01-15": { status: "blocked", timeSlots: [], notes: "" } }
        };

        // Calendar variables
        let currentCalendarDate = new Date();
        let selectedDate = null;

        // Navigation functions
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName).classList.remove('hidden');
            
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-pink-200');
            });
            
            // Load section-specific data
            if (sectionName === 'procedures') {
                loadProcedures();
            } else if (sectionName === 'schedule') {
                loadSchedule();
            } else if (sectionName === 'settings') {
                loadSettings();
            } else if (sectionName === 'dashboard') {
                updateDashboardStats();
            } else if (sectionName === 'faq-management') {
                loadFAQManagement();
            }
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
        }

        // Dashboard functions
        function updateDashboardStats() {
            document.getElementById('totalProcedures').textContent = clinicData.procedures.length;
            
            // Count total FAQs
            let totalFAQs = 0;
            clinicData.procedures.forEach(procedure => {
                if (procedure.faq && procedure.faq.length > 0) {
                    totalFAQs += procedure.faq.length;
                }
            });
            document.getElementById('totalFAQs').textContent = totalFAQs;
            
            // Update appointments count
            if (clinicData.appointments) {
                const today = new Date().toISOString().split('T')[0];
                const todayAppointments = clinicData.appointments.filter(apt => apt.date === today);
                document.getElementById('todayAppointments').textContent = todayAppointments.length;
            } else {
                document.getElementById('todayAppointments').textContent = '0';
            }
        }

        // Procedures functions
        function loadProcedures() {
            const grid = document.getElementById('proceduresGrid');
            grid.innerHTML = '';
            
            clinicData.procedures.forEach(procedure => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-lg overflow-hidden card-hover';
                card.innerHTML = `
                    <!-- Header with icon and category -->
                    <div class="bg-gradient-to-r from-purple-500 to-pink-500 p-4 text-white">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">${procedure.icon}</span>
                                <div>
                                    <h3 class="text-xl font-bold">${procedure.name}</h3>
                                    <p class="text-sm opacity-90">${procedure.category}</p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="editProcedure(${procedure.id})" class="text-white hover:text-gray-200 transition-colors">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteProcedure(${procedure.id})" class="text-white hover:text-red-200 transition-colors">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="p-6 space-y-4">
                        <!-- Price and Duration -->
                        <div class="flex justify-between items-center">
                            <div class="text-3xl font-bold text-purple-600">R$ ${procedure.price.toLocaleString('pt-BR')}</div>
                            <div class="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                                <i class="fas fa-clock mr-1"></i>${procedure.duration} min
                            </div>
                        </div>
                        
                        <!-- Description -->
                        <p class="text-gray-700 text-sm leading-relaxed">${procedure.description}</p>
                        
                        <!-- Benefits -->
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                <i class="fas fa-star text-yellow-500 mr-2"></i>Benefícios
                            </h4>
                            <div class="grid grid-cols-2 gap-1">
                                ${procedure.benefits.map(benefit => 
                                    `<div class="text-xs text-gray-600 flex items-center">
                                        <i class="fas fa-check text-green-500 mr-1 text-xs"></i>
                                        ${benefit}
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                        
                        <!-- Payment Options -->
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                <i class="fas fa-credit-card text-blue-500 mr-2"></i>Formas de Pagamento
                            </h4>
                            <div class="space-y-1">
                                ${procedure.paymentOptions.map(option => 
                                    `<div class="text-xs text-gray-600 bg-blue-50 px-2 py-1 rounded">
                                        ${option}
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                        
                        <!-- Contraindications -->
                        <div class="border-t pt-3">
                            <h4 class="font-semibold text-gray-800 mb-1 flex items-center text-sm">
                                <i class="fas fa-exclamation-triangle text-orange-500 mr-2"></i>Contraindicações
                            </h4>
                            <p class="text-xs text-gray-600">${procedure.contraindications}</p>
                        </div>
                        
                        <!-- Action Button -->
                        <button onclick="scheduleProcedure(${procedure.id})" class="w-full bg-gradient-to-r from-green-500 to-teal-600 text-white py-2 rounded-lg hover:from-green-600 hover:to-teal-700 transition-all text-sm font-medium">
                            <i class="fas fa-calendar-plus mr-2"></i>Agendar Procedimento
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function openProcedureModal(procedureId = null) {
            const modal = document.getElementById('procedureModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            if (procedureId) {
                const procedure = clinicData.procedures.find(p => p.id === procedureId);
                if (procedure) {
                    document.getElementById('procedureName').value = procedure.name;
                    document.getElementById('procedurePrice').value = procedure.price;
                    document.getElementById('procedureDuration').value = procedure.duration;
                    document.getElementById('procedureDescription').value = procedure.description;
                }
            } else {
                document.getElementById('procedureName').value = '';
                document.getElementById('procedureCategory').value = 'Harmonização Facial';
                document.getElementById('procedurePrice').value = '';
                document.getElementById('procedureDuration').value = '';
                document.getElementById('procedureIcon').value = '';
                document.getElementById('procedureDescription').value = '';
                document.getElementById('procedureBenefits').value = '';
                document.getElementById('procedurePayments').value = '';
                document.getElementById('procedureContraindications').value = '';
                document.getElementById('procedureFAQ').value = '';
            }
        }

        function closeProcedureModal() {
            const modal = document.getElementById('procedureModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function saveProcedure() {
            const name = document.getElementById('procedureName').value;
            const category = document.getElementById('procedureCategory').value;
            const price = parseFloat(document.getElementById('procedurePrice').value);
            const duration = parseInt(document.getElementById('procedureDuration').value);
            const icon = document.getElementById('procedureIcon').value || '💆‍♀️';
            const description = document.getElementById('procedureDescription').value;
            const benefits = document.getElementById('procedureBenefits').value.split(',').map(b => b.trim()).filter(b => b);
            const paymentOptions = document.getElementById('procedurePayments').value.split(',').map(p => p.trim()).filter(p => p);
            const contraindications = document.getElementById('procedureContraindications').value;
            const faqText = document.getElementById('procedureFAQ').value;
            
            if (!name || !price || !duration || !description) {
                alert('Por favor, preencha pelo menos nome, preço, duração e descrição!');
                return;
            }
            
            // Parse FAQ
            const faq = [];
            if (faqText.trim()) {
                const faqLines = faqText.split('\n').filter(line => line.trim());
                faqLines.forEach(line => {
                    const parts = line.split('|');
                    if (parts.length === 2) {
                        faq.push({
                            question: parts[0].trim(),
                            answer: parts[1].trim()
                        });
                    }
                });
            }
            
            const newProcedure = {
                id: Date.now(),
                name,
                category,
                price,
                duration,
                icon,
                description,
                benefits: benefits.length > 0 ? benefits : ['Melhora aparência', 'Aumenta autoestima'],
                paymentOptions: paymentOptions.length > 0 ? paymentOptions : ['À vista', 'Cartão', 'PIX'],
                contraindications: contraindications || 'Consulte nossos especialistas',
                faq: faq.length > 0 ? faq : [
                    { question: "Como funciona este procedimento?", answer: "É um tratamento seguro e eficaz realizado por profissionais qualificados! 😊" },
                    { question: "Quanto tempo dura o resultado?", answer: "Os resultados variam de pessoa para pessoa. Agende uma avaliação para mais detalhes! ✨" }
                ]
            };
            
            clinicData.procedures.push(newProcedure);
            closeProcedureModal();
            loadProcedures();
            showSuccess('Procedimento adicionado com sucesso!');
        }

        function editProcedure(id) {
            openProcedureModal(id);
        }

        function deleteProcedure(id) {
            if (confirm('Tem certeza que deseja excluir este procedimento?')) {
                clinicData.procedures = clinicData.procedures.filter(p => p.id !== id);
                loadProcedures();
                showSuccess('Procedimento excluído com sucesso!');
            }
        }

        function scheduleProcedure(id) {
            const procedure = clinicData.procedures.find(p => p.id === id);
            if (procedure) {
                // Store selected procedure for scheduling
                clinicData.selectedProcedureForScheduling = procedure;
                showSuccess(`Redirecionando para agendamento de ${procedure.name}...`);
                setTimeout(() => {
                    showSection('schedule');
                    openSchedulingModal();
                }, 1500);
            }
        }

        // Schedule functions
        function loadSchedule() {
            const container = document.getElementById('scheduleConfig');
            const days = {
                monday: 'Segunda-feira',
                tuesday: 'Terça-feira',
                wednesday: 'Quarta-feira',
                thursday: 'Quinta-feira',
                friday: 'Sexta-feira',
                saturday: 'Sábado',
                sunday: 'Domingo'
            };
            
            container.innerHTML = '';
            
            Object.entries(days).forEach(([key, name]) => {
                const schedule = clinicData.schedule[key];
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-4 p-3 bg-gray-50 rounded-lg';
                div.innerHTML = `
                    <div class="flex items-center">
                        <input type="checkbox" id="${key}Active" ${schedule.active ? 'checked' : ''} class="mr-2">
                        <label for="${key}Active" class="font-medium text-gray-700 w-24">${name}</label>
                    </div>
                    <div class="flex space-x-2">
                        <input type="time" id="${key}Start" value="${schedule.start}" class="p-2 border border-gray-300 rounded">
                        <span class="text-gray-500">até</span>
                        <input type="time" id="${key}End" value="${schedule.end}" class="p-2 border border-gray-300 rounded">
                    </div>
                `;
                container.appendChild(div);
            });
            
            loadCalendar();
        }

        // Calendar functions
        function loadCalendar() {
            updateCalendarHeader();
            generateCalendarDays();
        }

        function updateCalendarHeader() {
            const monthNames = [
                'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            
            const monthYear = `${monthNames[currentCalendarDate.getMonth()]} ${currentCalendarDate.getFullYear()}`;
            document.getElementById('currentMonth').textContent = monthYear;
        }

        function generateCalendarDays() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // First day of the month and number of days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'p-2';
                grid.appendChild(emptyDay);
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayOfWeek = new Date(year, month, day).getDay();
                
                dayElement.className = 'p-2 text-center text-sm cursor-pointer rounded transition-colors hover:bg-purple-100';
                dayElement.textContent = day;
                dayElement.onclick = () => selectDate(dateStr);
                
                // Apply styling based on day status
                const customSchedule = clinicData.customSchedules[dateStr];
                const dayName = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'][dayOfWeek];
                const regularSchedule = clinicData.schedule[dayName];
                
                if (customSchedule) {
                    if (customSchedule.status === 'blocked') {
                        dayElement.className += ' bg-red-200 text-red-800';
                    } else if (customSchedule.status === 'limited') {
                        dayElement.className += ' bg-yellow-200 text-yellow-800';
                    } else {
                        dayElement.className += ' bg-green-200 text-green-800';
                    }
                } else if (!regularSchedule.active) {
                    dayElement.className += ' bg-gray-200 text-gray-500';
                } else {
                    dayElement.className += ' bg-green-100 text-green-700';
                }
                
                // Highlight today
                const today = new Date();
                if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                    dayElement.className += ' ring-2 ring-purple-500';
                }
                
                grid.appendChild(dayElement);
            }
        }

        function previousMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            loadCalendar();
        }

        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            loadCalendar();
        }

        function selectDate(dateStr) {
            selectedDate = dateStr;
            loadDayDetails(dateStr);
        }

        function loadDayDetails(dateStr) {
            const container = document.getElementById('dayDetails');
            const date = new Date(dateStr);
            const dayOfWeek = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'][date.getDay()];
            const dayNames = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
            
            const customSchedule = clinicData.customSchedules[dateStr];
            const regularSchedule = clinicData.schedule[dayOfWeek];
            
            let content = `
                <div class="space-y-4">
                    <div class="text-center">
                        <h4 class="text-lg font-semibold text-gray-800">${date.getDate()} de ${date.toLocaleDateString('pt-BR', { month: 'long' })}</h4>
                        <p class="text-sm text-gray-600">${dayNames[date.getDay()]}</p>
                    </div>
            `;
            
            if (customSchedule) {
                content += `
                    <div class="p-3 rounded-lg ${customSchedule.status === 'blocked' ? 'bg-red-50' : customSchedule.status === 'limited' ? 'bg-yellow-50' : 'bg-green-50'}">
                        <p class="font-medium ${customSchedule.status === 'blocked' ? 'text-red-700' : customSchedule.status === 'limited' ? 'text-yellow-700' : 'text-green-700'}">
                            ${customSchedule.status === 'blocked' ? 'Dia Bloqueado' : customSchedule.status === 'limited' ? 'Horário Limitado' : 'Horário Personalizado'}
                        </p>
                `;
                
                if (customSchedule.timeSlots && customSchedule.timeSlots.length > 0) {
                    content += '<div class="mt-2 space-y-1">';
                    customSchedule.timeSlots.forEach(slot => {
                        content += `<p class="text-sm text-gray-600">${slot.start} - ${slot.end}</p>`;
                    });
                    content += '</div>';
                }
                
                if (customSchedule.notes) {
                    content += `<p class="text-sm text-gray-600 mt-2">${customSchedule.notes}</p>`;
                }
                
                content += '</div>';
            } else {
                if (regularSchedule.active) {
                    content += `
                        <div class="p-3 bg-green-50 rounded-lg">
                            <p class="font-medium text-green-700">Horário Normal</p>
                            <p class="text-sm text-gray-600">${regularSchedule.start} - ${regularSchedule.end}</p>
                        </div>
                    `;
                } else {
                    content += `
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <p class="font-medium text-gray-700">Fechado</p>
                            <p class="text-sm text-gray-600">Não funciona neste dia da semana</p>
                        </div>
                    `;
                }
            }
            
            content += `
                    <button onclick="openDayScheduleModal('${dateStr}')" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-2 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all">
                        <i class="fas fa-edit mr-2"></i>Configurar Dia
                    </button>
                </div>
            `;
            
            container.innerHTML = content;
        }

        function openDayScheduleModal(dateStr) {
            selectedDate = dateStr;
            const date = new Date(dateStr);
            const dayNames = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
            
            document.getElementById('modalDayTitle').textContent = `${date.getDate()} de ${date.toLocaleDateString('pt-BR', { month: 'long' })} - ${dayNames[date.getDay()]}`;
            
            const customSchedule = clinicData.customSchedules[dateStr];
            
            // Reset form
            document.querySelector('input[name="dayStatus"][value="available"]').checked = true;
            document.getElementById('dayNotes').value = '';
            document.getElementById('customTimeSlots').innerHTML = '';
            
            if (customSchedule) {
                document.querySelector(`input[name="dayStatus"][value="${customSchedule.status}"]`).checked = true;
                document.getElementById('dayNotes').value = customSchedule.notes || '';
                
                if (customSchedule.timeSlots) {
                    customSchedule.timeSlots.forEach(slot => {
                        addTimeSlot(slot.start, slot.end);
                    });
                }
            }
            
            const modal = document.getElementById('dayScheduleModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeDayScheduleModal() {
            const modal = document.getElementById('dayScheduleModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function addTimeSlot(startTime = '', endTime = '') {
            const container = document.getElementById('customTimeSlots');
            const slotDiv = document.createElement('div');
            slotDiv.className = 'flex items-center space-x-2';
            slotDiv.innerHTML = `
                <input type="time" value="${startTime}" class="flex-1 p-2 border border-gray-300 rounded">
                <span class="text-gray-500">até</span>
                <input type="time" value="${endTime}" class="flex-1 p-2 border border-gray-300 rounded">
                <button onclick="this.parentElement.remove()" class="text-red-600 hover:text-red-800">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(slotDiv);
        }

        function saveDaySchedule() {
            if (!selectedDate) return;
            
            const status = document.querySelector('input[name="dayStatus"]:checked').value;
            const notes = document.getElementById('dayNotes').value;
            const timeSlots = [];
            
            // Collect time slots
            const slotElements = document.querySelectorAll('#customTimeSlots > div');
            slotElements.forEach(slot => {
                const inputs = slot.querySelectorAll('input[type="time"]');
                if (inputs[0].value && inputs[1].value) {
                    timeSlots.push({
                        start: inputs[0].value,
                        end: inputs[1].value
                    });
                }
            });
            
            // Save to data
            if (status === 'available' && timeSlots.length === 0 && !notes) {
                // Remove custom schedule if it's just default available
                delete clinicData.customSchedules[selectedDate];
            } else {
                clinicData.customSchedules[selectedDate] = {
                    status,
                    timeSlots,
                    notes
                };
            }
            
            closeDayScheduleModal();
            loadCalendar();
            loadDayDetails(selectedDate);
            showSuccess('Configuração do dia salva com sucesso!');
        }

        function saveSchedule() {
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            days.forEach(day => {
                clinicData.schedule[day] = {
                    active: document.getElementById(`${day}Active`).checked,
                    start: document.getElementById(`${day}Start`).value,
                    end: document.getElementById(`${day}End`).value
                };
            });
            
            loadCalendar(); // Refresh calendar to show updated schedule
            showSuccess('Horários salvos com sucesso!');
        }

        // ChatBot functions
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessageToChat(message, 'user');
            input.value = '';
            
            // Simulate bot response
            setTimeout(() => {
                const response = generateBotResponse(message);
                addMessageToChat(response, 'bot');
            }, 1000);
        }

        function toggleProceduresDropdown() {
            const dropdown = document.getElementById('proceduresDropdown');
            const isHidden = dropdown.classList.contains('hidden');
            
            if (isHidden) {
                loadProceduresDropdown();
                dropdown.classList.remove('hidden');
            } else {
                dropdown.classList.add('hidden');
            }
        }

        function toggleFAQDropdown() {
            const dropdown = document.getElementById('faqDropdown');
            const isHidden = dropdown.classList.contains('hidden');
            
            if (isHidden) {
                loadFAQProceduresDropdown();
                dropdown.classList.remove('hidden');
            } else {
                dropdown.classList.add('hidden');
            }
        }

        function loadFAQProceduresDropdown() {
            const container = document.getElementById('faqProceduresList');
            container.innerHTML = '';
            
            clinicData.procedures.forEach(procedure => {
                const item = document.createElement('div');
                item.className = 'flex items-center p-3 hover:bg-green-50 cursor-pointer transition-colors border-b border-gray-100 last:border-b-0';
                item.onclick = () => selectProcedureForFAQ(procedure);
                item.innerHTML = `
                    <span class="text-xl mr-3">${procedure.icon}</span>
                    <div class="flex-1">
                        <div class="font-medium text-gray-800">${procedure.name}</div>
                        <div class="text-sm text-gray-600">${procedure.faq.length} perguntas frequentes</div>
                    </div>
                    <i class="fas fa-chevron-right text-gray-400 text-sm"></i>
                `;
                container.appendChild(item);
            });
        }

        function selectProcedureForFAQ(procedure) {
            // Hide dropdown
            document.getElementById('faqDropdown').classList.add('hidden');
            
            // Send user message
            addMessageToChat(`Perguntas sobre ${procedure.name}`, 'user');
            
            // Show FAQ options
            setTimeout(() => {
                showFAQOptions(procedure);
            }, 1000);
        }

        function showFAQOptions(procedure) {
            const faqButtons = procedure.faq.map((faq, index) => 
                `<button onclick="answerFAQ('${procedure.name}', ${index})" class="block w-full text-left p-4 mb-3 bg-gradient-to-r from-green-50 to-teal-50 hover:from-green-100 hover:to-teal-100 rounded-xl transition-all shadow-sm hover:shadow-md border border-green-200">
                    <div class="flex items-start space-x-3">
                        <div class="text-green-600 text-lg mt-0.5">❓</div>
                        <div class="flex-1">
                            <p class="font-medium text-gray-800 text-base leading-relaxed">${faq.question}</p>
                            <p class="text-xs text-green-600 mt-1 opacity-75">Clique para ver a resposta</p>
                        </div>
                        <div class="text-green-500 text-sm">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </button>`
            ).join('');
            
            const response = `
                <div class="max-w-md">
                    <div class="bg-gradient-to-r from-green-500 to-teal-600 text-white p-5 rounded-t-xl">
                        <h3 class="font-bold text-lg flex items-center mb-2">
                            ${procedure.icon} Perguntas Frequentes
                        </h3>
                        <p class="text-sm opacity-90">${procedure.name}</p>
                        <p class="text-xs opacity-75 mt-1">Escolha uma pergunta abaixo:</p>
                    </div>
                    <div class="bg-white p-5 rounded-b-xl border border-gray-200 shadow-lg">
                        ${faqButtons}
                        <div class="mt-4 p-3 bg-gray-50 rounded-lg text-center">
                            <p class="text-xs text-gray-600">💬 Não encontrou sua dúvida? Digite sua pergunta!</p>
                        </div>
                    </div>
                </div>
            `;
            
            addMessageToChat(response, 'bot');
        }

        function answerFAQ(procedureName, faqIndex) {
            const procedure = clinicData.procedures.find(p => p.name === procedureName);
            if (!procedure || !procedure.faq[faqIndex]) return;
            
            const faq = procedure.faq[faqIndex];
            
            // Add user question
            addMessageToChat(faq.question, 'user');
            
            // Simulate typing and then show answer
            setTimeout(() => {
                addTypingIndicator();
            }, 500);
            
            setTimeout(() => {
                removeTypingIndicator();
                addMessageToChat(faq.answer, 'bot');
                

            }, 2500);
        }

        function addTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'flex mb-4';
            typingDiv.innerHTML = `
                <div class="chat-bubble-bot text-white p-3 rounded-lg">
                    <div class="flex space-x-1">
                        <div class="w-2 h-2 bg-white rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                        <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function loadProceduresDropdown() {
            const container = document.getElementById('proceduresList');
            container.innerHTML = '';
            
            clinicData.procedures.forEach(procedure => {
                const item = document.createElement('div');
                item.className = 'flex items-center p-3 hover:bg-purple-50 cursor-pointer transition-colors border-b border-gray-100 last:border-b-0';
                item.onclick = () => selectProcedureFromDropdown(procedure);
                item.innerHTML = `
                    <span class="text-xl mr-3">${procedure.icon}</span>
                    <div class="flex-1">
                        <div class="font-medium text-gray-800">${procedure.name}</div>
                        <div class="text-sm text-gray-600">${procedure.category} • R$ ${procedure.price.toLocaleString('pt-BR')}</div>
                    </div>
                    <i class="fas fa-chevron-right text-gray-400 text-sm"></i>
                `;
                container.appendChild(item);
            });
        }

        function selectProcedureFromDropdown(procedure) {
            // Hide dropdown
            document.getElementById('proceduresDropdown').classList.add('hidden');
            
            // Send user message
            addMessageToChat(`Quero saber sobre ${procedure.name}`, 'user');
            
            // Generate detailed procedure card response
            setTimeout(() => {
                const response = generateProcedureCardResponse(procedure);
                addMessageToChat(response, 'bot');
            }, 1000);
        }

        function scheduleFromChat(procedureId) {
            const procedure = clinicData.procedures.find(p => p.id === procedureId);
            if (procedure) {
                // Store selected procedure for scheduling
                clinicData.selectedProcedureForScheduling = procedure;
                
                // Add user message
                addMessageToChat(`Quero agendar ${procedure.name}`, 'user');
                
                // Show bot response
                setTimeout(() => {
                    addMessageToChat('Perfeito! Vou abrir o formulário de agendamento para você. 📅✨', 'bot');
                    
                    // Open scheduling modal after a short delay
                    setTimeout(() => {
                        openSchedulingModal();
                    }, 1500);
                }, 1000);
            }
        }

        function generateLocationCard() {
            const encodedAddress = encodeURIComponent(clinicData.address);
            
            return `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden max-w-sm">
                    <!-- Header -->
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 p-4 text-white">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-map-marker-alt text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold">Nossa Localização</h3>
                                <p class="text-sm opacity-90">Como chegar até nós</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="p-5 space-y-4">
                        <!-- Address -->
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                                <i class="fas fa-building text-blue-600 text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-800 mb-1">${clinicData.name}</h4>
                                <p class="text-gray-600 text-sm leading-relaxed">${clinicData.address}</p>
                            </div>
                        </div>
                        
                        <!-- Contact -->
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-phone text-green-600 text-sm"></i>
                            </div>
                            <div>
                                <p class="text-gray-800 font-medium">${clinicData.phone}</p>
                                <p class="text-gray-500 text-xs">Ligue para mais informações</p>
                            </div>
                        </div>
                        
                        <!-- Navigation Buttons -->
                        <div class="space-y-2 pt-2">
                            <button onclick="openInWaze('${encodedAddress}')" class="w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white py-3 rounded-lg hover:from-cyan-600 hover:to-blue-700 transition-all font-medium flex items-center justify-center space-x-2">
                                <i class="fab fa-waze text-lg"></i>
                                <span>Abrir no Waze</span>
                            </button>
                            
                            <button onclick="openInGoogleMaps('${encodedAddress}')" class="w-full bg-gradient-to-r from-red-500 to-pink-600 text-white py-3 rounded-lg hover:from-red-600 hover:to-pink-700 transition-all font-medium flex items-center justify-center space-x-2">
                                <i class="fab fa-google text-lg"></i>
                                <span>Abrir no Google Maps</span>
                            </button>
                        </div>
                        
                        <!-- Additional Info -->
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-3 rounded-lg">
                            <div class="flex items-center space-x-2 mb-2">
                                <i class="fas fa-info-circle text-blue-600"></i>
                                <span class="font-medium text-blue-800 text-sm">Dicas para sua visita:</span>
                            </div>
                            <ul class="text-xs text-blue-700 space-y-1">
                                <li>• Chegue 15 minutos antes do horário</li>
                                <li>• Temos estacionamento disponível</li>
                                <li>• Traga um documento com foto</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateProcedureCardResponse(procedure) {
            return `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden max-w-sm">
                    <!-- Header with icon and category -->
                    <div class="bg-gradient-to-r from-purple-500 to-pink-500 p-4 text-white">
                        <div class="flex items-center space-x-3 mb-2">
                            <span class="text-2xl">${procedure.icon}</span>
                            <div>
                                <h3 class="text-xl font-bold">${procedure.name}</h3>
                                <p class="text-sm opacity-90">${procedure.category}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="p-6 space-y-4">
                        <!-- Price and Duration -->
                        <div class="flex justify-between items-center">
                            <div class="text-3xl font-bold text-purple-600">R$ ${procedure.price.toLocaleString('pt-BR')}</div>
                            <div class="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                                <i class="fas fa-clock mr-1"></i>${procedure.duration} min
                            </div>
                        </div>
                        
                        <!-- Description -->
                        <p class="text-gray-700 text-sm leading-relaxed">${procedure.description}</p>
                        
                        <!-- Benefits -->
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                <i class="fas fa-star text-yellow-500 mr-2"></i>Benefícios
                            </h4>
                            <div class="grid grid-cols-1 gap-1">
                                ${procedure.benefits.map(benefit => 
                                    `<div class="text-xs text-gray-600 flex items-center">
                                        <i class="fas fa-check text-green-500 mr-1 text-xs"></i>
                                        ${benefit}
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                        
                        <!-- Payment Options -->
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                <i class="fas fa-credit-card text-blue-500 mr-2"></i>Formas de Pagamento
                            </h4>
                            <div class="space-y-1">
                                ${procedure.paymentOptions.map(option => 
                                    `<div class="text-xs text-gray-600 bg-blue-50 px-2 py-1 rounded">
                                        ${option}
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                        
                        <!-- Contraindications -->
                        <div class="border-t pt-3">
                            <h4 class="font-semibold text-gray-800 mb-1 flex items-center text-sm">
                                <i class="fas fa-exclamation-triangle text-orange-500 mr-2"></i>Contraindicações
                            </h4>
                            <p class="text-xs text-gray-600">${procedure.contraindications}</p>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="space-y-2">
                            <button onclick="scheduleFromChat(${procedure.id})" class="w-full bg-gradient-to-r from-green-500 to-teal-600 text-white py-2 rounded-lg hover:from-green-600 hover:to-teal-700 transition-all text-sm font-medium">
                                <i class="fas fa-calendar-plus mr-2"></i>Agendar Agora
                            </button>
                            <div class="bg-gradient-to-r from-green-50 to-teal-50 p-3 rounded-lg text-center">
                                <p class="text-xs text-gray-600">Ou digite "agendar ${procedure.name}" para continuar</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function sendQuickMessage(message) {
            addMessageToChat(message, 'user');
            
            setTimeout(() => {
                const response = generateBotResponse(message);
                addMessageToChat(response, 'bot');
            }, 1000);
        }

        function addMessageToChat(message, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex mb-4 ${sender === 'user' ? 'justify-end' : ''}`;
            
            const bubbleClass = sender === 'user' ? 'chat-bubble-user' : 'chat-bubble-bot';
            messageDiv.innerHTML = `
                <div class="${bubbleClass} text-white p-3 rounded-lg max-w-xs">
                    <p>${message}</p>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function generateBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Check if user wants to schedule a specific procedure
            const scheduleMatch = lowerMessage.match(/agendar (.+)/);
            if (scheduleMatch) {
                const procedureName = scheduleMatch[1];
                const procedure = clinicData.procedures.find(p => 
                    p.name.toLowerCase().includes(procedureName) || 
                    procedureName.includes(p.name.toLowerCase())
                );
                
                if (procedure) {
                    return `Ótimo! Você quer agendar ${procedure.name}. 📅\n\nPara finalizar seu agendamento, preciso de algumas informações:\n\n• Nome completo\n• Telefone\n• Data preferida\n• Horário preferido\n\nVocê pode me passar essas informações ou ligar diretamente para ${clinicData.phone} para agendar! 😊`;
                }
            }
            
            // Check if user is asking about a specific procedure
            clinicData.procedures.forEach(procedure => {
                if (lowerMessage.includes(procedure.name.toLowerCase())) {
                    return generateProcedureCardResponse(procedure);
                }
            });
            
            if (lowerMessage.includes('agendar') || lowerMessage.includes('consulta')) {
                return 'Perfeito! Para agendar sua consulta, clique no botão "💆‍♀️ Procedimentos" acima e escolha qual tratamento você tem interesse. Assim posso te dar todas as informações detalhadas! 😊';
            }
            
            if (lowerMessage.includes('procedimento') || lowerMessage.includes('tratamento')) {
                return 'Temos diversos procedimentos incríveis! 💆‍♀️\n\nClique no botão "💆‍♀️ Procedimentos" acima para ver nossa lista completa com todos os detalhes, preços e benefícios de cada tratamento. Assim você pode escolher o que mais combina com você! ✨';
            }
            
            if (lowerMessage.includes('preço') || lowerMessage.includes('valor')) {
                let response = 'Nossos preços:\n\n';
                clinicData.procedures.forEach(p => {
                    response += `${p.icon} ${p.name}: R$ ${p.price.toLocaleString('pt-BR')}\n`;
                });
                response += '\n💳 Formas de pagamento: ' + clinicData.paymentMethods.join(', ');
                response += '\n\nPara ver detalhes completos de cada procedimento, clique em "💆‍♀️ Procedimentos" acima!';
                return response;
            }
            
            if (lowerMessage.includes('localização') || lowerMessage.includes('endereço')) {
                return generateLocationCard();
            }
            
            if (lowerMessage.includes('horário') || lowerMessage.includes('funcionamento')) {
                return '🕐 Nossos horários de funcionamento:\n\n• Segunda a Sexta: 08:00 às 18:00\n• Sábado: 08:00 às 14:00\n• Domingo: Fechado\n\nEstamos sempre prontos para recebê-lo! 😊';
            }
            
            return 'Olá! 😊 Como posso ajudá-lo hoje?\n\nPosso te ajudar com:\n• 💆‍♀️ Informações sobre procedimentos\n• 💰 Preços e formas de pagamento\n• 📅 Agendamentos\n• 📍 Localização e horários\n\nUse os botões acima ou digite sua dúvida!';
        }

        // Settings functions
        function loadSettings() {
            document.getElementById('clinicNameInput').value = clinicData.name;
            document.getElementById('clinicPhone').value = clinicData.phone;
            document.getElementById('clinicAddress').value = clinicData.address;
            document.getElementById('clinicLogo').value = clinicData.logo;
            
            loadPaymentMethods();
            generateChatLink();
        }

        function loadPaymentMethods() {
            const container = document.getElementById('paymentMethods');
            container.innerHTML = '';
            
            clinicData.paymentMethods.forEach((method, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-2 bg-gray-50 rounded-lg';
                div.innerHTML = `
                    <span class="text-gray-700">${method}</span>
                    <button onclick="removePaymentMethod(${index})" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(div);
            });
        }

        function addPaymentMethod() {
            const method = prompt('Digite a nova forma de pagamento:');
            if (method && method.trim()) {
                clinicData.paymentMethods.push(method.trim());
                loadPaymentMethods();
                showSuccess('Forma de pagamento adicionada!');
            }
        }

        function removePaymentMethod(index) {
            clinicData.paymentMethods.splice(index, 1);
            loadPaymentMethods();
            showSuccess('Forma de pagamento removida!');
        }

        function generateChatLink() {
            const clinicSlug = clinicData.name.toLowerCase()
                .replace(/[^a-z0-9]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
            
            const link = `https://chatbot.clinica.com/${clinicSlug}`;
            document.getElementById('chatLinkInput').value = link;
            return link;
        }

        function copyChatLink() {
            const input = document.getElementById('chatLinkInput');
            input.select();
            document.execCommand('copy');
            showSuccess('Link copiado para a área de transferência!');
        }

        function shareToWhatsApp() {
            const link = generateChatLink();
            const message = `Conheça nossa clínica! Agende sua consulta através do nosso chatbot: ${link}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        }

        function shareToInstagram() {
            showSuccess('Cole o link em sua bio do Instagram ou stories!');
        }

        function downloadQRCode() {
            showSuccess('Funcionalidade de QR Code será implementada em breve!');
        }

        function saveSettings() {
            clinicData.name = document.getElementById('clinicNameInput').value;
            clinicData.phone = document.getElementById('clinicPhone').value;
            clinicData.address = document.getElementById('clinicAddress').value;
            clinicData.logo = document.getElementById('clinicLogo').value;
            
            // Update clinic name in chat
            document.getElementById('clinicName').textContent = clinicData.name;
            
            showSuccess('Configurações salvas com sucesso!');
        }

        // Scheduling Modal functions
        function openSchedulingModal() {
            const procedure = clinicData.selectedProcedureForScheduling;
            if (!procedure) return;
            
            // Load procedure info
            const infoContainer = document.getElementById('selectedProcedureInfo');
            infoContainer.innerHTML = `
                <div class="flex items-center space-x-4">
                    <span class="text-3xl">${procedure.icon}</span>
                    <div class="flex-1">
                        <h4 class="text-lg font-bold text-purple-800">${procedure.name}</h4>
                        <p class="text-sm text-purple-600">${procedure.category}</p>
                        <div class="flex items-center space-x-4 mt-2">
                            <span class="text-lg font-bold text-purple-800">R$ ${procedure.price.toLocaleString('pt-BR')}</span>
                            <span class="text-sm text-purple-600">
                                <i class="fas fa-clock mr-1"></i>${procedure.duration} min
                            </span>
                        </div>
                    </div>
                </div>
            `;
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('appointmentDate').min = today;
            
            // Clear form
            document.getElementById('clientName').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('appointmentDate').value = '';
            document.getElementById('appointmentTime').value = '';
            document.getElementById('appointmentNotes').value = '';
            
            // Show modal
            const modal = document.getElementById('schedulingModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeSchedulingModal() {
            const modal = document.getElementById('schedulingModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function confirmScheduling() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientPhone = document.getElementById('clientPhone').value.trim();
            const appointmentDate = document.getElementById('appointmentDate').value;
            const appointmentTime = document.getElementById('appointmentTime').value;
            const appointmentNotes = document.getElementById('appointmentNotes').value.trim();
            
            // Validation
            if (!clientName) {
                alert('Por favor, digite seu nome completo.');
                return;
            }
            
            if (!clientPhone) {
                alert('Por favor, digite seu telefone.');
                return;
            }
            
            if (!appointmentDate) {
                alert('Por favor, selecione uma data.');
                return;
            }
            
            if (!appointmentTime) {
                alert('Por favor, selecione um horário.');
                return;
            }
            
            const procedure = clinicData.selectedProcedureForScheduling;
            
            // Create appointment object
            const appointment = {
                id: Date.now(),
                clientName,
                clientPhone,
                procedure: procedure.name,
                procedureIcon: procedure.icon,
                date: appointmentDate,
                time: appointmentTime,
                duration: procedure.duration,
                price: procedure.price,
                notes: appointmentNotes,
                status: 'agendado',
                createdAt: new Date().toISOString()
            };
            
            // Initialize appointments array if it doesn't exist
            if (!clinicData.appointments) {
                clinicData.appointments = [];
            }
            
            // Add appointment
            clinicData.appointments.push(appointment);
            
            // Close modal
            closeSchedulingModal();
            
            // Show success message with appointment details
            const formattedDate = new Date(appointmentDate).toLocaleDateString('pt-BR');
            const successMessage = `🎉 Agendamento confirmado!\n\n📅 ${formattedDate} às ${appointmentTime}\n💆‍♀️ ${procedure.name}\n👤 ${clientName}\n\nEntraremos em contato para confirmar!`;
            
            showSuccess(successMessage);
            
            // Update dashboard stats
            updateDashboardStats();
        }

        // Navigation functions
        function openInWaze(encodedAddress) {
            const wazeUrl = `https://waze.com/ul?q=${encodedAddress}&navigate=yes`;
            window.open(wazeUrl, '_blank');
        }

        function openInGoogleMaps(encodedAddress) {
            const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodedAddress}`;
            window.open(googleMapsUrl, '_blank');
        }

        // FAQ Management functions
        let selectedProcedureForFAQ = null;

        function loadFAQManagement() {
            loadFAQProceduresList();
            // Reset editor
            const editor = document.getElementById('faqEditor');
            editor.innerHTML = `
                <div class="text-center py-12">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-arrow-left text-gray-400 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-600 mb-2">Selecione um Procedimento</h3>
                    <p class="text-gray-500">Escolha um procedimento na lista ao lado para gerenciar suas perguntas e respostas</p>
                </div>
            `;
        }

        function loadFAQProceduresList() {
            const container = document.getElementById('faqProceduresList');
            container.innerHTML = '';
            
            clinicData.procedures.forEach(procedure => {
                const faqCount = procedure.faq ? procedure.faq.length : 0;
                const item = document.createElement('div');
                item.className = `p-4 rounded-lg cursor-pointer transition-all hover:bg-purple-50 border-2 ${selectedProcedureForFAQ?.id === procedure.id ? 'border-purple-500 bg-purple-50' : 'border-gray-200'}`;
                item.onclick = () => selectProcedureForFAQEdit(procedure);
                item.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl">${procedure.icon}</span>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800">${procedure.name}</h4>
                            <p class="text-sm text-gray-600">${procedure.category}</p>
                            <div class="flex items-center mt-1">
                                <i class="fas fa-question-circle text-purple-500 text-xs mr-1"></i>
                                <span class="text-xs text-purple-600">${faqCount} pergunta${faqCount !== 1 ? 's' : ''}</span>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function selectProcedureForFAQEdit(procedure) {
            selectedProcedureForFAQ = procedure;
            loadFAQProceduresList(); // Refresh to show selection
            loadFAQEditor(procedure);
        }

        function loadFAQEditor(procedure) {
            const editor = document.getElementById('faqEditor');
            const faqs = procedure.faq || [];
            
            editor.innerHTML = `
                <!-- Header -->
                <div class="border-b border-gray-200 pb-6 mb-6">
                    <div class="flex items-center space-x-4 mb-4">
                        <span class="text-3xl">${procedure.icon}</span>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">${procedure.name}</h3>
                            <p class="text-gray-600">${procedure.category}</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="bg-purple-100 px-3 py-1 rounded-full">
                                <span class="text-purple-700 text-sm font-medium">${faqs.length} pergunta${faqs.length !== 1 ? 's' : ''} cadastrada${faqs.length !== 1 ? 's' : ''}</span>
                            </div>
                        </div>
                        <button onclick="addNewFAQ()" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-2 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all">
                            <i class="fas fa-plus mr-2"></i>Nova Pergunta
                        </button>
                    </div>
                </div>

                <!-- FAQ List -->
                <div id="faqList" class="space-y-4">
                    ${faqs.length === 0 ? `
                        <div class="text-center py-8 bg-gray-50 rounded-lg">
                            <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-question text-gray-400"></i>
                            </div>
                            <h4 class="text-lg font-semibold text-gray-600 mb-2">Nenhuma pergunta cadastrada</h4>
                            <p class="text-gray-500 mb-4">Adicione perguntas frequentes para que sua secretária virtual possa responder automaticamente</p>
                            <button onclick="addNewFAQ()" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-2 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all">
                                <i class="fas fa-plus mr-2"></i>Adicionar Primeira Pergunta
                            </button>
                        </div>
                    ` : faqs.map((faq, index) => `
                        <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex items-start space-x-3 flex-1">
                                    <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                                        <span class="text-white text-sm font-bold">${index + 1}</span>
                                    </div>
                                    <div class="flex-1">
                                        <h5 class="font-semibold text-gray-800 mb-2">${faq.question}</h5>
                                        <p class="text-gray-600 text-sm leading-relaxed">${faq.answer}</p>
                                    </div>
                                </div>
                                <div class="flex space-x-2 ml-4">
                                    <button onclick="editFAQ(${index})" class="text-blue-600 hover:text-blue-800 p-2 rounded transition-colors" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteFAQ(${index})" class="text-red-600 hover:text-red-800 p-2 rounded transition-colors" title="Excluir">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <!-- Save Button -->
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <div class="flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            <i class="fas fa-info-circle mr-1"></i>
                            As alterações são salvas automaticamente
                        </div>
                        <button onclick="testFAQResponses()" class="bg-gradient-to-r from-green-500 to-teal-600 text-white px-6 py-2 rounded-lg hover:from-green-600 hover:to-teal-700 transition-all">
                            <i class="fas fa-play mr-2"></i>Testar Respostas
                        </button>
                    </div>
                </div>
            `;
        }

        function addNewFAQ() {
            if (!selectedProcedureForFAQ) return;
            
            const question = prompt('Digite a pergunta:');
            if (!question || !question.trim()) return;
            
            const answer = prompt('Digite a resposta:');
            if (!answer || !answer.trim()) return;
            
            // Initialize FAQ array if it doesn't exist
            if (!selectedProcedureForFAQ.faq) {
                selectedProcedureForFAQ.faq = [];
            }
            
            // Add new FAQ
            selectedProcedureForFAQ.faq.push({
                question: question.trim(),
                answer: answer.trim()
            });
            
            // Update the procedure in the main data
            const procedureIndex = clinicData.procedures.findIndex(p => p.id === selectedProcedureForFAQ.id);
            if (procedureIndex !== -1) {
                clinicData.procedures[procedureIndex] = selectedProcedureForFAQ;
            }
            
            // Refresh the editor
            loadFAQEditor(selectedProcedureForFAQ);
            loadFAQProceduresList();
            updateDashboardStats();
            showSuccess('Pergunta adicionada com sucesso!');
        }

        function editFAQ(index) {
            if (!selectedProcedureForFAQ || !selectedProcedureForFAQ.faq[index]) return;
            
            const faq = selectedProcedureForFAQ.faq[index];
            
            const newQuestion = prompt('Editar pergunta:', faq.question);
            if (newQuestion === null) return; // User cancelled
            
            const newAnswer = prompt('Editar resposta:', faq.answer);
            if (newAnswer === null) return; // User cancelled
            
            if (!newQuestion.trim() || !newAnswer.trim()) {
                alert('Pergunta e resposta não podem estar vazias!');
                return;
            }
            
            // Update FAQ
            selectedProcedureForFAQ.faq[index] = {
                question: newQuestion.trim(),
                answer: newAnswer.trim()
            };
            
            // Update the procedure in the main data
            const procedureIndex = clinicData.procedures.findIndex(p => p.id === selectedProcedureForFAQ.id);
            if (procedureIndex !== -1) {
                clinicData.procedures[procedureIndex] = selectedProcedureForFAQ;
            }
            
            // Refresh the editor
            loadFAQEditor(selectedProcedureForFAQ);
            showSuccess('Pergunta atualizada com sucesso!');
        }

        function deleteFAQ(index) {
            if (!selectedProcedureForFAQ || !selectedProcedureForFAQ.faq[index]) return;
            
            const faq = selectedProcedureForFAQ.faq[index];
            if (!confirm(`Tem certeza que deseja excluir a pergunta:\n"${faq.question}"?`)) return;
            
            // Remove FAQ
            selectedProcedureForFAQ.faq.splice(index, 1);
            
            // Update the procedure in the main data
            const procedureIndex = clinicData.procedures.findIndex(p => p.id === selectedProcedureForFAQ.id);
            if (procedureIndex !== -1) {
                clinicData.procedures[procedureIndex] = selectedProcedureForFAQ;
            }
            
            // Refresh the editor
            loadFAQEditor(selectedProcedureForFAQ);
            loadFAQProceduresList();
            updateDashboardStats();
            showSuccess('Pergunta excluída com sucesso!');
        }

        function testFAQResponses() {
            if (!selectedProcedureForFAQ) return;
            
            showSuccess(`Redirecionando para testar as respostas de ${selectedProcedureForFAQ.name}...`);
            setTimeout(() => {
                showSection('chatbot');
                // Auto-select the procedure in the chatbot
                setTimeout(() => {
                    selectProcedureForFAQ(selectedProcedureForFAQ);
                }, 500);
            }, 1500);
        }

        // Utility functions
        function showSuccess(message) {
            document.getElementById('successMessage').textContent = message;
            const modal = document.getElementById('successModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeSuccessModal() {
            const modal = document.getElementById('successModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // Event listeners
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            const proceduresDropdown = document.getElementById('proceduresDropdown');
            const faqDropdown = document.getElementById('faqDropdown');
            const proceduresButton = e.target.closest('[onclick="toggleProceduresDropdown()"]');
            const faqButton = e.target.closest('[onclick="toggleFAQDropdown()"]');
            
            if (!proceduresButton && !proceduresDropdown.contains(e.target)) {
                proceduresDropdown.classList.add('hidden');
            }
            
            if (!faqButton && !faqDropdown.contains(e.target)) {
                faqDropdown.classList.add('hidden');
            }
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            showSection('dashboard');
            updateDashboardStats();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'978742ae509be2cd',t:'MTc1Njc1NTg0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

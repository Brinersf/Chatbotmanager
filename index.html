<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatBot Pro - Agendamento Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
            background: #f3e8ff; /* Cor de fundo suave para o corpo */
        }
        .chat-message {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .procedure-card, .btn {
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .procedure-card:hover, .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        .chat-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 1rem;
        }
        .whatsapp-btn {
            background-color: #25D366;
            color: white;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 9999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .whatsapp-btn:hover {
            background-color: #128C7E;
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">
    <div class="chat-container bg-gray-100 md:flex md:justify-center md:items-center">
        <div class="w-full max-w-sm h-full bg-white shadow-xl rounded-lg flex flex-col overflow-hidden md:h-[600px] md:max-w-md">
            <div id="bot-header" class="bg-fuchsia-800 text-white p-5 flex items-center shadow-lg">
                <img id="bot-icon" src="https://i.ibb.co/L8Fw2tF/bot-icon.png" alt="Bot Icon" class="w-12 h-12 rounded-full mr-4 border-2 border-white transform hover:scale-110 transition-transform duration-300">
                <div>
                    <h3 id="bot-name" class="font-bold text-xl">Bot Estética Pro</h3>
                    <p class="text-sm text-fuchsia-200">Online</p>
                </div>
            </div>

            <div id="chat-messages" class="chat-messages flex-grow space-y-4">
                <div class="flex justify-start chat-message">
                    <div id="bot-message-bubble" class="bg-fuchsia-200 text-fuchsia-800 p-4 rounded-xl max-w-[85%] shadow-md">
                        <p id="welcome-message">Olá! Bem-vindo(a) à nossa clínica de estética. Como posso te ajudar hoje?</p>
                    </div>
                </div>
            </div>

            <div id="user-input-area" class="bg-gray-50 p-4 border-t border-gray-200">
                </div>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const userInputArea = document.getElementById('user-input-area');
        let currentStep = 'welcome';
        let schedulingData = {};

        // Procedures data
        const procedures = [
            { id: 'botox', name: 'Botox Facial', price: 950.00, duration: '60 min', benefits: 'Reduz rugas e linhas de expressão, rejuvenesce a pele.' },
            { id: 'preenchimento', name: 'Preenchimento Labial', price: 1200.00, duration: '45 min', benefits: 'Aumenta o volume e contorno dos lábios, hidrata e suaviza.' },
            { id: 'limpeza', name: 'Limpeza de Pele', price: 150.00, duration: '90 min', benefits: 'Remove impurezas, cravos e espinhas, renova a pele.' },
            { id: 'peeling', name: 'Peeling Químico', price: 300.00, duration: '30 min', benefits: 'Melhora a textura da pele, clareia manchas e estimula a produção de colágeno.' }
        ];

        // Simulated data for calendar and times
        const calendarData = {};
        const availableTimes = ["09:00", "10:30", "14:00", "15:30", "17:00"];

        function addBotMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', 'justify-start', 'chat-message');
            messageDiv.innerHTML = `<div class="bg-fuchsia-200 text-fuchsia-800 p-4 rounded-xl max-w-[85%] shadow-md">${text}</div>`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addUserMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', 'justify-end', 'chat-message');
            messageDiv.innerHTML = `<div class="bg-fuchsia-500 text-white p-4 rounded-xl max-w-[85%] shadow-md">${text}</div>`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function clearInputArea() {
            userInputArea.innerHTML = '';
        }

        function showProceduresList() {
            clearInputArea();
            addBotMessage('Claro! Aqui estão os procedimentos que oferecemos:');
            const proceduresHtml = procedures.map(p => `
                <div class="procedure-card bg-white p-5 rounded-xl shadow-md border border-gray-200" data-id="${p.id}" data-price="${p.price}" data-name="${p.name}">
                    <h4 class="font-bold text-fuchsia-800">${p.name}</h4>
                    <p class="text-sm text-gray-500 mt-1">R$ ${p.price.toFixed(2).replace('.', ',')}</p>
                </div>
            `).join('');

            const proceduresContainer = document.createElement('div');
            proceduresContainer.classList.add('grid', 'grid-cols-2', 'gap-4');
            proceduresContainer.innerHTML = proceduresHtml;
            userInputArea.appendChild(proceduresContainer);

            proceduresContainer.querySelectorAll('.procedure-card').forEach(card => {
                card.addEventListener('click', () => {
                    const selectedProcedure = {
                        id: card.dataset.id,
                        name: card.dataset.name,
                        price: parseFloat(card.dataset.price)
                    };
                    schedulingData.procedure = selectedProcedure.name;
                    schedulingData.price = selectedProcedure.price;
                    addUserMessage(selectedProcedure.name);
                    showCalendar();
                });
            });
        }

        function showCalendar() {
            clearInputArea();
            addBotMessage('Ótima escolha! Agora, por favor, selecione uma data para o seu agendamento:');

            const today = new Date();
            let currentMonth = today.getMonth();
            let currentYear = today.getFullYear();

            const calendarHtml = `
                <div class="bg-white p-4 rounded-lg shadow-md mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <button id="prevMonth" class="px-3 py-1 bg-gray-200 rounded-lg"><i class="fas fa-chevron-left"></i></button>
                        <h4 id="currentMonthYear" class="text-lg font-semibold text-gray-700"></h4>
                        <button id="nextMonth" class="px-3 py-1 bg-gray-200 rounded-lg"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-center text-sm">
                        <div class="font-bold text-gray-500">D</div>
                        <div class="font-bold text-gray-500">S</div>
                        <div class="font-bold text-gray-500">T</div>
                        <div class="font-bold text-gray-500">Q</div>
                        <div class="font-bold text-gray-500">Q</div>
                        <div class="font-bold text-gray-500">S</div>
                        <div class="font-bold text-gray-500">S</div>
                    </div>
                </div>
            `;
            userInputArea.innerHTML = calendarHtml;

            const calendarGridEl = document.getElementById('calendar-grid');
            const currentMonthYearEl = document.getElementById('currentMonthYear');
            
            function renderCalendar() {
                calendarGridEl.innerHTML = '';
                const firstDay = new Date(currentYear, currentMonth, 1);
                const lastDay = new Date(currentYear, currentMonth + 1, 0);

                const dayNames = ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'];
                dayNames.forEach(day => {
                    const dayEl = document.createElement('div');
                    dayEl.classList.add('font-bold', 'text-gray-500');
                    dayEl.textContent = day;
                    calendarGridEl.appendChild(dayEl);
                });

                for (let i = 0; i < firstDay.getDay(); i++) {
                    const emptyCell = document.createElement('div');
                    calendarGridEl.appendChild(emptyCell);
                }

                for (let i = 1; i <= lastDay.getDate(); i++) {
                    const dayEl = document.createElement('div');
                    dayEl.classList.add('p-2', 'rounded-lg', 'calendar-day');
                    dayEl.textContent = i;
                    const dayDate = new Date(currentYear, currentMonth, i);
                    const formattedDate = dayDate.toISOString().slice(0, 10);
                    if (dayDate.toDateString() === today.toDateString()) {
                        dayEl.classList.add('today');
                    }
                    if (calendarData[formattedDate]) {
                        dayEl.classList.add('has-appointments');
                    }
                    dayEl.addEventListener('click', () => {
                        document.querySelectorAll('.calendar-day.selected-day').forEach(el => el.classList.remove('selected-day'));
                        dayEl.classList.add('selected-day');
                        schedulingData.date = formattedDate;
                        addUserMessage(`${i}/${currentMonth + 1}/${currentYear}`);
                        showAvailableTimes();
                    });
                    calendarGridEl.appendChild(dayEl);
                }
                currentMonthYearEl.textContent = firstDay.toLocaleString('pt-BR', { month: 'long', year: 'numeric' });
            }
            
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar();
            });
            document.getElementById('nextMonth').addEventListener('click', () => {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar();
            });

            renderCalendar();
        }

        function showAvailableTimes() {
            clearInputArea();
            addBotMessage('Agora, escolha um horário disponível:');
            const timesHtml = availableTimes.map(time => `
                <button class="btn bg-fuchsia-600 text-white p-3 rounded-xl hover:bg-fuchsia-700 transition" data-time="${time}">${time}</button>
            `).join('');
            const timesContainer = document.createElement('div');
            timesContainer.classList.add('flex', 'flex-wrap', 'gap-2');
            timesContainer.innerHTML = timesHtml;
            userInputArea.appendChild(timesContainer);

            timesContainer.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('click', () => {
                    schedulingData.time = btn.dataset.time;
                    addUserMessage(btn.dataset.time);
                    requestClientInfo();
                });
            });
        }

        function requestClientInfo() {
            clearInputArea();
            addBotMessage('Por favor, digite seu nome completo e telefone para confirmar o agendamento.');
            const formHtml = `
                <div class="space-y-4">
                    <div>
                        <input type="text" id="client-name" placeholder="Seu nome completo" class="w-full p-3 border border-gray-300 rounded-xl">
                    </div>
                    <div>
                        <input type="tel" id="client-phone" placeholder="Seu telefone (com DDD)" class="w-full p-3 border border-gray-300 rounded-xl">
                    </div>
                    <button id="confirm-booking" class="btn w-full bg-fuchsia-600 text-white p-3 rounded-xl hover:bg-fuchsia-700 transition">Confirmar Agendamento</button>
                </div>
            `;
            userInputArea.innerHTML = formHtml;

            document.getElementById('confirm-booking').addEventListener('click', () => {
                const clientName = document.getElementById('client-name').value;
                const clientPhone = document.getElementById('client-phone').value;
                if (clientName && clientPhone) {
                    schedulingData.clientName = clientName;
                    schedulingData.clientPhone = clientPhone;
                    addUserMessage('Dados enviados!');
                    confirmBooking();
                } else {
                    alert('Por favor, preencha todos os campos.');
                }
            });
        }
        
        function confirmBooking() {
            clearInputArea();
            addBotMessage(`Pronto! Seu agendamento para **${schedulingData.procedure}** foi confirmado para o dia **${schedulingData.date}** às **${schedulingData.time}**. Em breve entraremos em contato com você, **${schedulingData.clientName}**, pelo seu telefone **${schedulingData.clientPhone}**.`);
            userInputArea.innerHTML = `
                <div class="text-center p-4">
                    <p class="text-sm text-gray-500 mb-4">Para continuar a conversa ou tirar dúvidas, clique no botão abaixo para nos encontrar no WhatsApp!</p>
                    <a href="https://wa.me/${localStorage.getItem('clinicPhone') || '+5599999999999'}?text=Olá, tenho um agendamento com a ${localStorage.getItem('clinicName') || 'Nossa Clínica'} para o dia ${schedulingData.date} às ${schedulingData.time}." target="_blank" class="whatsapp-btn">
                        <i class="fab fa-whatsapp text-2xl mr-2"></i> Abrir WhatsApp
                    </a>
                </div>
            `;
        }

        function initialPrompt() {
            clearInputArea();
            const welcomeHtml = `
                <div class="space-y-4 text-center">
                    <button id="view-procedures-btn" class="btn w-full bg-fuchsia-600 text-white p-3 rounded-xl hover:bg-fuchsia-700 transition">Ver Procedimentos e Agendar</button>
                    <button id="whatsapp-btn" class="btn w-full bg-green-500 text-white p-3 rounded-xl hover:bg-green-600 transition">Falar com um atendente</button>
                </div>
            `;
            userInputArea.innerHTML = welcomeHtml;
            document.getElementById('view-procedures-btn').addEventListener('click', showProceduresList);
            document.getElementById('whatsapp-btn').addEventListener('click', () => {
                window.open(`https://wa.me/${localStorage.getItem('clinicPhone') || '+5599999999999'}?text=Olá, gostaria de falar com um atendente sobre um agendamento.`, '_blank');
            });
        }

        // Initialize the chatbot with data from localStorage
        document.addEventListener('DOMContentLoaded', function() {
            const botName = localStorage.getItem('botName') || 'Bot Estética Pro';
            const botIcon = localStorage.getItem('botIcon') || 'https://i.ibb.co/L8Fw2tF/bot-icon.png';
            const botColor = localStorage.getItem('botColor') || '#8b5cf6';
            const welcomeMessage = localStorage.getItem('welcomeMessage') || 'Olá! Bem-vindo(a) à nossa clínica de estética. Como posso te ajudar hoje?';

            document.getElementById('bot-name').textContent = botName;
            document.getElementById('bot-icon').src = botIcon;
            document.getElementById('welcome-message').textContent = welcomeMessage;
            document.getElementById('bot-header').style.backgroundColor = botColor;
            document.getElementById('bot-message-bubble').style.backgroundColor = botColor;
            document.getElementById('bot-message-bubble').style.color = '#fff';

            initialPrompt();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9796bd28d362cb60',t:'MTc1NjkxODE1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>